<!-- 
 _______          __                       __   ___________                                .__           _________                                    
 \      \   _____/  |___  _  _____________|  | _\_   _____/__________   ____   ____   _____|__| ____    /   _____/__.__. ______ _____   ____   ____   
 /   |   \_/ __ \   __\ \/ \/ /  _ \_  __ \  |/ /|    __)/  _ \_  __ \_/ __ \ /    \ /  ___/  |/ ___\   \_____  <   |  |/  ___//     \ /  _ \ /    \  
/    |    \  ___/|  |  \     (  <_> )  | \/    < |     \(  <_> )  | \/\  ___/|   |  \\___ \|  \  \___   /        \___  |\___ \|  Y Y  (  <_> )   |  \ 
\____|__  /\___  >__|   \/\_/ \____/|__|  |__|_ \\___  / \____/|__|    \___  >___|  /____  >__|\___  > /_______  / ____/____  >__|_|  /\____/|___|  / 
        \/     \/                              \/    \/                    \/     \/     \/        \/          \/\/         \/      \/            \/  
		
Created by Networkforensic.dk
- Latest change date - 24 September 2024  
- Sysmon version 15.15
- Sysmon Config version 54
- Schemaversion 4.90
- This Sysmon Config can run on the following versions of Sysmon 15.00 - 15.10 - 15.11 - 15.12 - 15.14 - 15.15
- Supported Microsoft OS - Windows Server 2012 and higher - Windows 8.1 and higher
-->
<Sysmon schemaversion="4.90">
  <HashAlgorithms>sha1,sha256,imphash</HashAlgorithms>
  <CheckRevocation/> <!-- Check loaded drivers, log if their code-Signing certificate has been revoked -->
    <EventFiltering>
<!-- Event ID 1 == Process Creation - Excluded -->
	<RuleGroup name="Process Creation" groupRelation="or">
		<ProcessCreate onmatch="exclude">
		 <Image condition="image">C:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</Image> <!-- Splunk - excluded -->
		 <Image condition="image">C:\Program Files\SplunkUniversalForwarder\bin\btool.exe</Image> <!-- Splunk - excluded -->
		 <ParentImage condition="image">C:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage> <!-- Splunk - excluded -->
		</ProcessCreate>
	</RuleGroup>
<!-- Event ID 1 == Process Creation - include. -->
	<RuleGroup name="" groupRelation="or">
      <ProcessCreate onmatch="include">	  
	 <!--Steal or Forge Kerberos Tickets-->	 
		<Rule name="technique_id=T1548.002,technique_name=Steal or Forge Kerberos Tickets - hh" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1558/ -->
			<Image condition="image">hh.exe</Image>
		</Rule>		
		<Rule name="technique_id=T1550.003,technique_name=Use Alternate Authentication Material: Pass the Ticket - Klist" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1558/ -->
			<Image condition="image">klist.exe</Image>
		</Rule>
	<!--Disk Wipe - Disk Content Wipe-->
		<Rule name="technique_id=T1485.S0195,technique_name=Data Destruction - SDelete" groupRelation="and"> 
			<OriginalFileName condition="image">SDelete.exe</OriginalFileName>
			<CommandLine condition="contains">sdelete</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1561.001,technique_name=Disk Content Wipe - cipher" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1561/001/--> 
			<OriginalFileName condition="image">CIPHER.EXE</OriginalFileName>
			<CommandLine condition="contains">/w</CommandLine>
		</Rule>	
	<!--Mavinject - Execution-->	
		<Rule name="technique_id=T1218.013,technique_name=Mavinject - Execution - Mavinject" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1218/013/ -->
			<OriginalFileName condition="contains any">Mavinject.exe;mavinject64.exe</OriginalFileName>
			<CommandLine condition="contains">INJECTRUNNING</CommandLine>
		</Rule>			
	<!--Bypass User Account Control-->	
		<Rule name="technique_id=T1548.002,technique_name=Bypass User Account Control - fodhelper" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1548/002/ -->
			<ParentImage condition="image">fodhelper.exe</ParentImage>
		</Rule>
	<!--Application Shimming-->
		<Rule name="technique_id=T1546.011,technique_name= Application Shimming- sdbinst" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1546/011/ -->
			<Image condition="image">sdbinst.exe</Image>
		</Rule>			
	<!--Process Injection - Privilege Escalation-->
		<Rule name="technique_id=T1055,technique_name=Process Injection - Privilege Escalation- userinit" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1055/ -->
			<Image condition="image">userinit.exe</Image>
			<ParentImage condition="excludes any">\dwm.exe;\winlogon.exe</ParentImage>
		</Rule>
	<!--Indicator Blocking-->
		<Rule name="technique_id=T1562.006,technique_name=Impair Defenses Indicator Blocking - fltMC" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1562/006/ -->
			<OriginalFileName condition="is">fltMC.exe</OriginalFileName>
			<CommandLine condition="contains any">detach;unload</CommandLine>
		</Rule>			
	<!--Accessibility Features-->
		<Rule name="technique_id=T1546.008,technique_name=Accessibility Feature - utilman" groupRelation="and"> <!-- REF: https://attack.mitre.org/techniques/T1546/008/ --> 
			<ParentImage condition="image">utilman.exe</ParentImage>
			<Image condition="contains any">C:\Windows\System32\ATBroker.exe;C:\Windows\System32\Magnify.exe;C:\Windows\System32\sethc.exe;C:\Windows\System32\osk.exe;C:\Windows\System32\Narrator.exe;C:\Windows\System32\DisplaySwitch.exe</Image>
		</Rule>		
	<!--Create or Modify System Process - Windows Service-->
		<Rule name="technique_id=T1543.003,technique_name=Create or Modify System Process - Windows Service - pnputil.exe " groupRelation="and"> <!--REF: https://attack.mitre.org/techniques/T1543/003/ -->
			<OriginalFileName condition="contains">pnputil.exe</OriginalFileName>
			<CommandLine condition="contains any">/add-driver;/install;/uninstall;/disable-device</CommandLine>
		</Rule>		
	<!--Sandbox detection AntiForensic-->	
		<ParentImage name="WindowsSandbox,technique_name=AntiForensic - Windows Sandbox " condition="image">WindowsSandbox.exe</ParentImage> <!-- Can be used to hide artifacts -->	
	<!--Known BAD-->		
		<Rule name="technique_id=T1003.001,technique_name=LOLBAS LSASS Memory - sqldumper" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqldumper/ -->
			<OriginalFileName condition="contains">sqldumper.exe</OriginalFileName>
			<CommandLine condition="contains">0x</CommandLine>
		</Rule>
		<Rule name="technique_id=S0552,technique_name=TOOL - AdFind" groupRelation="and"> <!--REF: https://attack.mitre.org/software/S0552/ -->
			<OriginalFileName condition="contains">AdFind.exe</OriginalFileName>
			<CommandLine condition="contains">-</CommandLine>
		</Rule>
		<Rule name="technique_id=S0552,technique_name=TOOL - PCHunter" groupRelation="and"> <!--REF:https://www.majorgeeks.com/files/details/pc_hunter.html Used by Akira Ransomware -->
			<OriginalFileName condition="contains">PCHunter.exe</OriginalFileName>
		</Rule>		
		<Rule name="technique_id=S0552,technique_name=TOOL - IObit File Unlocker" groupRelation="and"> <!--REF: https://thedfirreport.com/2024/04/01/from-onenote-to-ransomnote-an-ice-cold-intrusion/ -->
			<Product condition="is">Unlocker</Product>
			<Company condition="is">IObit Information Technology</Company>
		</Rule>		
		<Image name="technique_id=S0552,technique_name=TOOL - LaZagne" condition="image">LaZagne.exe</Image> <!--REF:https://github.com/AlessandroZ/LaZagne Used by Akira Ransomware -->	
	<!--Known LOLBAS Process-->	
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - AddInutil" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Addinutil/ -->
          <Image condition="end with">\AddInutil.exe</Image>
          <CommandLine condition="contains">-AddinRoot:</CommandLine>
        </Rule>
		<Rule name="technique_id=T1015,technique_name=LOLBAS Accessibility Features Persistence - AtBroker" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Atbroker/ -->
          <Image condition="end with">\AtBroker.exe</Image>
          <CommandLine condition="contains">/start</CommandLine>
        </Rule>		
		<Rule name="technique_id=T1078,technique_name=LOLBAS Valid Accounts - cmdkey" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Cmdkey/ -->
          <Image condition="end with">\cmdkey.exe</Image>
          <CommandLine condition="contains">/list</CommandLine>
        </Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Cmdl32" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Cmdl32/ -->
          <Image condition="end with">\Cmdl32.exe</Image>
          <CommandLine condition="contains any">/lan;/vpn</CommandLine>
        </Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Wsl" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/OtherMSBinaries/Wsl/ -->
			<OriginalFileName condition="contains any">bash.exe;wsl.exe;ubuntu.exe;kali.exe</OriginalFileName>
			<CommandLine condition="contains any">-e;/e;-u root;--exec bash;dev/tcp;~ -d;~ /d</CommandLine>
		</Rule>
		<Rule name="technique_id=T1053.005,technique_name=LOLBAS Scheduled Task - schtasks" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Schtasks/ -->
			<Image condition="image">schtasks.exe</Image>
			<CommandLine condition="contains any">/create;-create;/change;-change</CommandLine>
			<CurrentDirectory condition="excludes">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\</CurrentDirectory>
			<ParentImage condition="excludes">C:\Program Files\Common Files\microsoft shared\ClickToRun\officesvcmgr.exe</ParentImage>
			<CommandLine condition="excludes">Sentinel\AutoRepair</CommandLine> <!--SentinelOne exclusion-->
			<ParentImage condition="excludes">C:\Program Files\AMD\CIM\Bin64\InstallManagerApp.exe</ParentImage>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - bitsadmin" groupRelation="and"> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/ -->
			<OriginalFileName condition="is">bitsadmin.exe</OriginalFileName>
			<CommandLine condition="contains any">CREATE;TRANSFER;DOWNLOAD;UPLOAD;ADDFILE;SetNotifyFlags;SetNotifyCmdLine;SetMinRetryDelay;SetCustomHeaders;RESUME</CommandLine>
			<CommandLine condition="excludes all">util;setieproxy;localsystem;AUTODETECT</CommandLine>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Certutil" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Certutil/ -->
			<OriginalFileName condition="image">certutil.exe</OriginalFileName>
			<CommandLine condition="contains all">urlcache;split;f</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.003,technique_name=LOLBAS CMSTP - CMSTP NIS" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmstp/ -->
			<OriginalFileName condition="is">CMSTP.exe</OriginalFileName>
			<CommandLine condition="contains all">/ni;/s</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.003,technique_name=LOLBAS CMSTP - CMSTP NSS" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmstp/ -->
			<OriginalFileName condition="is">CMSTP.exe</OriginalFileName>
			<CommandLine condition="contains all">/ns;/s</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218.003,technique_name=LOLBAS CMSTP - CMSTP NISs" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmstp/ -->
			<OriginalFileName condition="is">CMSTP.exe</OriginalFileName>
			<CommandLine condition="contains all">-ni;-s</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218.003,technique_name=LOLBAS CMSTP - CMSTP NSSs" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmstp/ -->
			<OriginalFileName condition="is">CMSTP.exe</OriginalFileName>
			<CommandLine condition="contains all">-ns;-s</CommandLine>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - ConfigSecurityPolicy" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/ConfigSecurityPolicy/ -->
			<OriginalFileName condition="is">ConfigSecurityPolicy.exe</OriginalFileName>
			<CommandLine condition="contains">http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - certoc" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Certoc/-->
			<OriginalFileName condition="is">certoc.exe</OriginalFileName>
			<CommandLine condition="contains">-LoadDLL</CommandLine>
		</Rule>
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - sc" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Sc/ -->
			<OriginalFileName condition="image">sc.exe</OriginalFileName>
			<CommandLine condition="contains any">create;config</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - sc" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Sc/ -->
			<OriginalFileName condition="image">sc.exe</OriginalFileName>
			<CommandLine condition="contains any">create;config</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - CertReq" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Certreq/ -->
			<OriginalFileName condition="is">CertReq.exe</OriginalFileName>
			<CommandLine condition="contains all">-Post;http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1027.004,Technique=LOLBAS Compile - CSC," groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Csc/ -->
			<ParentImage condition="image">csc.exe</ParentImage>
			<CommandLine condition="contains any">out:;target:library</CommandLine>
		</Rule>
		<Rule name="technique_id=T1027.004,Technique=LOLBAS Compile After Delivery - CSC" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Csc/ -->
			<Image condition="image">csc.exe</Image>
			<ParentImage condition="image">wscript.exe</ParentImage>
			<ParentImage condition="image">cscript.exe</ParentImage>
			<ParentImage condition="image">mshta.exe</ParentImage>
		</Rule>	
		<Rule name="technique_id=T1059,Technique=LOLBAS Command and Scripting Interpreter - cscript" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Csc/ -->
			<Image condition="image">cscript.exe</Image>
			<CommandLine condition="contains any">.jse;.js;.vba;.vbe</CommandLine>
		</Rule>
		<Rule name="technique_id=T1567,technique_name=LOLBAS  Exfiltration Over Web Service - DataSvcUtil" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/DataSvcUtil/ -->
			<OriginalFileName condition="is">DataSvcUtil.exe</OriginalFileName>
			<CommandLine condition="contains">uri;http</CommandLine>
			</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Desktopimgdownldr" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Desktopimgdownldr/ -->
			<OriginalFileName condition="is">Desktopimgdownldr.exe</OriginalFileName>
			<CommandLine condition="contains">lockscreenurl;http</CommandLine>
		</Rule>
		<Rule name="technique_id=T1003.003,technique_name=LOLBAS NTDS - Diskshadow" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Diskshadow/ Windows Server 2008, Windows Server 2012, and Windows Server 2016 -->
			<OriginalFileName condition="is">Diskshadow.exe</OriginalFileName>
			<CommandLine condition="contains any">/s;exec</CommandLine>
		</Rule>
		<Rule name="technique_id=T1543.003,technique_name=LOLBAS Windows Service - dnscmd" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/ Only on DC with DNS admin rights -->
			<OriginalFileName condition="is">dnscmd.exe</OriginalFileName>
			<CommandLine condition="contains any">/config;\\</CommandLine>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Esentutl" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Esentutl/ -->
			<OriginalFileName condition="is">Esentutl.exe</OriginalFileName>
			<CommandLine condition="contains">/y;.vbs</CommandLine>
		</Rule>		
		 <Rule name="technique_id=T1548.002,technique_name=LOLBAS Bypass User Account Control - eventvwr" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Eventvwr/ -->
			<ParentImage name="technique_id=T1088,technique_name=Bypass User Account Control" condition="image">eventvwr.exe</ParentImage>
			<Image condition="is not">c:\windows\system32\mmc.exe</Image>
        </Rule>
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - explorer" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Explorer/ - User Execution No direct threat -->
			<ParentImage condition="image">explorer.exe</ParentImage>
			<Image condition="excludes any">\regedit.exe;\cmd.exe;terminal;\powershell</Image>
			<Company condition="excludes any">Microsoft;Realtek Semiconductor</Company>
		</Rule>
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Conhost" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Conhost/ -->
			<Image condition="image">CONHOST.EXE</Image>
			<ParentImage condition="excludes any">MpCmdRun.exe;cmd.exe;wevtutil.exe;powershell.exe;compattelrunner.exe;defrag.exe;dmclient.exe;disksnapshot.exe;NGenTask.exe;dstokenclean.exe</ParentImage>	
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - extrac32" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Extrac32/ -->
			<OriginalFileName condition="is">extrac32.exe</OriginalFileName>
			<CommandLine condition="contains all">extrac32.exe;\\</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1552.001,technique_name=LOLBAS Credentials In Files - Findstr" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Findstr/ -->
			<OriginalFileName condition="is">Findstr.exe</OriginalFileName>
			<CommandLine condition="contains any">\\;password;</CommandLine>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Finger" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Finger/ -->
			<OriginalFileName condition="is">Finger.exe</OriginalFileName>
			<CommandLine condition="contains all">user;cmd</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Forfiles" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Forfiles/ -->
			<OriginalFileName condition="is">Forfiles.exe</OriginalFileName>
			<CommandLine condition="contains all">/p;/m;/c</CommandLine>
		</Rule>	
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - FTP" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ftp/ -->
			<OriginalFileName condition="is">Ftp.exe</OriginalFileName>
			<CommandLine condition="contains">!</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - IMEWDBLD" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/IMEWDBLD/ -->
			<OriginalFileName condition="is">IMEWDBLD.exe</OriginalFileName>
			<CommandLine condition="contains">http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - iediagcmd" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Iediagcmd/ -->
			<OriginalFileName condition="is">iediagcmd.exe</OriginalFileName>
			<CommandLine condition="contains">/out</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - ieexec" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ieexec/ -->
			<OriginalFileName condition="is">ieexec.exe</OriginalFileName>
			<CommandLine condition="contains">http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - ilasm" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ilasm/ -->
			<OriginalFileName condition="is">ilasm.exe</OriginalFileName>
			<CommandLine condition="contains any">/exe;/dll</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - infDefaultInstall" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Infdefaultinstall/ -->
			<Image condition="image">infDefaultInstall.exe</Image>
		</Rule>		
		<Rule name="technique_id=T1218.004,technique_name=LOLBAS InstallUtil - InstallUtil" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Installutil/ -->
			<OriginalFileName condition="is">InstallUtil.exe</OriginalFileName>
			<CommandLine condition="contains all">-logfile=;-LogToConsole=false;-U</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - jsc" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Jsc/ -->
			<OriginalFileName condition="is">jsc.exe</OriginalFileName>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - ldifde" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ldifde/ -->
			<OriginalFileName condition="is">ldifde.exe</OriginalFileName>
			<CommandLine condition="contains all">-i;-f</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Makecab" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Makecab/ -->
			<OriginalFileName condition="is">Makecab.exe</OriginalFileName>
			<CommandLine condition="contains">\\;:</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - Microsoft.Workflow.Compiler" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Microsoft.Workflow.Compiler/ -->
			<OriginalFileName condition="is">Microsoft.Workflow.Compiler.exe</OriginalFileName>
		</Rule>		
		<Rule name="technique_id=T1218.014,technique_name=LOLBAS MMC - Load background COM with MMC" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Mmc/ -->
			<OriginalFileName condition="is">mmc.exe</OriginalFileName>
			<CommandLine condition="contains">-Embedding</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - MpCmdRun - Windows Defender payload download" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/MpCmdRun/ -->
			<OriginalFileName condition="is">MpCmdRun.exe</OriginalFileName>
			<CommandLine condition="contains all">-DownloadFile;-url;http;-path</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Msconfig" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msconfig/ -->
			<OriginalFileName condition="is">Msconfig.exe</OriginalFileName>
			<CommandLine condition="contains">-5</CommandLine>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Msedge - Silently download and file extension" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msedge/ -->
			<OriginalFileName condition="is">Msedge.exe</OriginalFileName>
			<CommandLine condition="contains all">--headless;--enable-logging;--disable-gpu;--dump-dom</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Msedge - Spawns child process of msedge and executes" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msedge/ -->
			<OriginalFileName condition="is">Msedge.exe</OriginalFileName>
			<CommandLine condition="contains all">---disable-gpu-sandbox;--gpu-launcher</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.005,technique_name=LOLBAS Mshta - mshta" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Mshta/ -->
			<OriginalFileName condition="is">mshta.exe</OriginalFileName>
			<CommandLine condition="contains">http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.007,technique_name=LOLBAS Msiexec - Msiexec - remote renamed .MSI file silently" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msiexec/ -->
			<OriginalFileName condition="is">Msiexec.exe</OriginalFileName>
			<CommandLine condition="contains all">/q;/i;http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.007,technique_name=LOLBAS Msiexec - Msiexec - register or un-register DLL" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msiexec/ -->
			<OriginalFileName condition="is">Msiexec.exe</OriginalFileName>
			<CommandLine condition="contains any">/y;/z</CommandLine>
		</Rule>
		<Rule name="technique_id=T1546.007,technique_name=LOLBAS Netsh Helper DLL - Netsh execute DLL for persistence - Netsh" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Netsh/ -->
			<OriginalFileName condition="is">Netsh.exe</OriginalFileName>
			<CommandLine condition="contains">add helper</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.008,technique_name=LOLBAS Odbcconf - Execute DllREgisterServer from DLL - Odbcconf" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Odbcconf/ -->
			<OriginalFileName condition="is">Odbcconf.exe</OriginalFileName>
			<CommandLine condition="contains any">/a;REGSVR</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Pcalua" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Pcalua/ -->
			<OriginalFileName condition="is">Pcalua.exe</OriginalFileName>
			<CommandLine condition="contains any">-a;\\</CommandLine>
		</Rule>
		<Rule name="technique_id=T1040,technique_name=LOLBAS Network Sniffing - Pktmon" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Pktmon/ -->
			<OriginalFileName condition="is">Pktmon.exe</OriginalFileName>
			<CommandLine condition="contains all">start;-etw</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1040,technique_name=LOLBAS Network Sniffing - netsh" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Pktmon/ -->
			<OriginalFileName condition="is">netsh.exe</OriginalFileName>
			<CommandLine condition="contains all">trace;start;capture=yes</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1547,technique_name=LOLBAS Boot or Logon Autostart Execution - Pnputil - Used for installing drivers" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Pnputil/ -->
			<OriginalFileName condition="is">Pnputil.exe</OriginalFileName>
			<CommandLine condition="contains all">-i;-a;.inf</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Presentationhost" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Presentationhost/ -->
			<OriginalFileName condition="is">Presentationhost.exe</OriginalFileName>
			<CommandLine condition="contains any">http;.xbap</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Print" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Print/ -->
			<OriginalFileName condition="is">Print.exe</OriginalFileName>
			<CommandLine condition="contains any">/D;\\</CommandLine>
		</Rule>
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - PrintBrm" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/PrintBrm/ -->
			<OriginalFileName condition="is">PrintBrm.exe</OriginalFileName>
			<CommandLine condition="contains any">-b;-d;-r;-f;.zip</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Provlaunch" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Provlaunch/ -->
			<OriginalFileName condition="is">Provlaunch.exe</OriginalFileName>
			<CommandLine condition="contains all">reg add;\Provisioning\Commands\</CommandLine>
		</Rule>
		<Rule name="technique_id=T1113,technique_name=LOLBAS Screen Capture - psr - Hidden screen capture" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Psr/ -->
			<OriginalFileName condition="is">psr.exe</OriginalFileName>
			<CommandLine condition="contains any">/start;/output;/gui 0</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Rasautou" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rasautou/ -->
			<OriginalFileName condition="is">Rasautou.exe</OriginalFileName>
			<CommandLine condition="contains any">-d;-p</CommandLine>
		</Rule>
		<Rule name="technique_id=T1003,technique_name=LOLBAS OS Credential Dumping - rdrleakdiag" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rdrleakdiag/ -->
			<OriginalFileName condition="is">rdrleakdiag.exe</OriginalFileName>
			<CommandLine condition="contains any">/p;/o</CommandLine>
		</Rule>
		<Rule name="technique_id=T1003.002,technique_name=LOLBAS Security Account Manager - reg - Dump reg hives" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Reg/ -->
			<OriginalFileName condition="is">Reg.exe</OriginalFileName>
			<CommandLine condition="contains any">reg save;security.bak;system.bak;sam.bak</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.009,technique_name=LOLBAS Regsvcs/Regasm - Regasm" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Regasm/ -->
			<OriginalFileName condition="is">Regasm.exe</OriginalFileName>
			<CommandLine condition="contains">/U</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Regedit" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Regedit/ -->
			<OriginalFileName condition="is">Regedit.exe</OriginalFileName>
			<CommandLine condition="contains">/E</CommandLine>
		</Rule>
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Regini" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Regini/ -->
			<OriginalFileName condition="is">Regini.exe</OriginalFileName>
			<CommandLine condition="contains">.ini</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Register-cimprovider" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Register-cimprovider/ -->
			<OriginalFileName condition="is">Register-cimprovider.exe</OriginalFileName>
			<CommandLine condition="contains">-path</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Regsvcs" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Regsvcs/ -->
			<OriginalFileName condition="is">Regsvcs.exe</OriginalFileName>
			<CommandLine condition="contains any">/u;.dll</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Regsvr32" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Regsvr32/ -->
			<OriginalFileName condition="is">Regsvr32.exe</OriginalFileName>
			<CommandLine condition="contains any">/s;/u;/i;http;</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Replace" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Replace/ -->
			<OriginalFileName condition="is">Replace.exe</OriginalFileName>
			<CommandLine condition="contains any">/A;\\</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1003,technique_name=LOLBAS OS Credential Dumping - Rpcping" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rpcping/  force the NTLM hash to be sent in the process-->
			<OriginalFileName condition="is">Rpcping.exe</OriginalFileName>
			<CommandLine condition="contains">-s;-e;privacy;-u/;NTLM</CommandLine>
		</Rule>
		<Rule name="technique_id=T1187,technique_name=LOLBAS Forced Authentication - Rpcping" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rpcping/  authenticated RPC call -->
			<OriginalFileName condition="is">Rpcping.exe</OriginalFileName>
			<CommandLine condition="contains">-s;-e;connect;-u/;NTLM</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.011,technique_name=LOLBAS Rundll32 - Rundll32 - Javascript" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rundll32/ Used by Windows to execute dll files -->
			<OriginalFileName condition="is">Rundll32.exe</OriginalFileName>
			<CommandLine condition="contains">javascript</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218.011,technique_name=LOLBAS Rundll32 - Rundll32 - Downloading" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rundll32/ Used by Windows to execute dll files -->
			<OriginalFileName condition="is">Rundll32.exe</OriginalFileName>
			<CommandLine condition="contains">http</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Runonce" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Runonce/ -->
			<OriginalFileName condition="is">Runonce.exe</OriginalFileName>
			<CommandLine condition="contains">/AlternateShellStartup</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Runscripthelper" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Runscripthelper/ -->
			<OriginalFileName condition="is">Runscripthelper.exe</OriginalFileName>
			<CommandLine condition="contains">surfacecheck</CommandLine>
		</Rule>
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Scriptrunner" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Scriptrunner/ -->
			<OriginalFileName condition="is">Scriptrunner.exe</OriginalFileName>
			<CommandLine condition="contains">-appvscript</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Setres" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Setres/ -->
			<OriginalFileName condition="is">Setres.exe</OriginalFileName>
			<CommandLine condition="contains all">-w;-h</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - SettingSyncHost" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/SettingSyncHost/ -->
			<OriginalFileName condition="is">SettingSyncHost.exe</OriginalFileName>
			<CommandLine condition="contains any">-LoadAndRunDiagScript;-LoadAndRunDiagScriptNoCab</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - SSH" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ssh/ -->
			<OriginalFileName condition="is">ssh.exe</OriginalFileName>
			<CommandLine condition="contains any">.exe;ProxyCommand</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Stordiag" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Stordiag/ -->
			<OriginalFileName condition="is">Stordiag.exe</OriginalFileName>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - SyncAppvPublishingServer" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/ -->
			<OriginalFileName condition="is">SyncAppvPublishingServer.exe</OriginalFileName>
			<CommandLine condition="contains any">http;DownloadString</CommandLine>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - TAR - Remote files" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Tar/ -->
			<OriginalFileName condition="is">Tar.exe</OriginalFileName>
			<CommandLine condition="contains any">-xf;\\</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - TAR - Remote files" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Tttracer/ -->
			<OriginalFileName condition="contains any">Ttdinject.exe;Tttracer.exe</OriginalFileName>
			<CommandLine condition="contains any">-dumpFull;.exe;/ClientParams</CommandLine>
		</Rule>
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - unregmp2 - Process Hijacking" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Unregmp2/ -->
			<OriginalFileName condition="contains">unregmp2.exe</OriginalFileName>
			<CommandLine condition="contains">/HideWMP</CommandLine>
		</Rule>
		<Rule name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - vbc" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Vbc/ -->
			<OriginalFileName condition="contains">vbc.exe</OriginalFileName>
			<CommandLine condition="contains any">/target;-reference</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218.012,technique_name=LOLBAS Verclsid - Verclsid" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Verclsid/ -->
			<OriginalFileName condition="contains">Verclsid.exe</OriginalFileName>
			<CommandLine condition="contains">/S;/C</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - wab" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wab/ -->
			<OriginalFileName condition="contains">Wab.exe</OriginalFileName>
		</Rule>
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - winget" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Winget/ -->
			<OriginalFileName condition="contains">winget.exe</OriginalFileName>
			<CommandLine condition="contains">install;--manifest</CommandLine>
		</Rule>
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Wlrmdr" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wlrmdr/ -->
			<OriginalFileName condition="contains">Wlrmdr.exe</OriginalFileName>
			<CommandLine condition="contains all">-s;-f;-a;-u</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Wmic ADS" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wmic/ -->
			<OriginalFileName condition="contains">Wmic.exe</OriginalFileName>
			<CommandLine condition="contains all">process;call;create;:</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS System Binary Proxy Execution - Wmic normal call" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wmic/ -->
			<OriginalFileName condition="contains">Wmic.exe</OriginalFileName>
			<CommandLine condition="contains all">process;call;create</CommandLine>
		</Rule>
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS System Binary Proxy Execution - Wmic call on remote system" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wmic/ -->
			<OriginalFileName condition="contains">Wmic.exe</OriginalFileName>
			<CommandLine condition="contains all">/node;process;call;create</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS System Binary Proxy Execution - Wmic call on remote system" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wmic/ -->
			<OriginalFileName condition="contains">Wmic.exe</OriginalFileName>
			<CommandLine condition="contains all">process;get;brief;/format;\\</CommandLine>
		</Rule>
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - WorkFolders" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/WorkFolders/ -->
			<OriginalFileName condition="contains">WorkFolders.exe</OriginalFileName>
		</Rule>
		<Rule name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Wscript" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wscript/ -->
			<OriginalFileName condition="contains">Wscript.exe</OriginalFileName>
			<CommandLine condition="contains any">http;//</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1548.002,technique_name=LOLBAS Bypass User Account Control - wsreset" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ -->
			<OriginalFileName condition="contains">wsreset.exe</OriginalFileName>
		</Rule>		
		<Rule name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - wuauclt - use windows update to run DLL" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wuauclt/ -->
			<OriginalFileName condition="contains">wuauclt.exe</OriginalFileName>
			<CommandLine condition="contains all">/UpdateDeploymentProvider;/RunHandlerComServer</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Xwizard - Remote file" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Xwizard/ -->
			<OriginalFileName condition="contains">Xwizard.exe</OriginalFileName>
			<CommandLine condition="contains">http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - msedge_proxy - Remote file" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/msedge_proxy/ -->
			<OriginalFileName condition="contains">msedge_proxy.exe</OriginalFileName>
			<CommandLine condition="contains any">http</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - msedgewebview2 - without sandbox 1" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/msedgewebview2/ -->
			<OriginalFileName condition="contains">msedgewebview2.exe</OriginalFileName>
			<CommandLine condition="contains all">--no-sandbox;--browser-subprocess-path</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - msedgewebview2 - without sandbox 2" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/msedgewebview2/ -->
			<OriginalFileName condition="contains">msedgewebview2.exe</OriginalFileName>
			<CommandLine condition="contains">--utility-cmd-prefix</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - msedgewebview2 - without sandbox 3" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/msedgewebview2/ -->
			<OriginalFileName condition="contains">msedgewebview2.exe</OriginalFileName>
			<CommandLine condition="contains all">--disable-gpu-sandbox;--gpu-launcher</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - msedgewebview2 - without sandbox 3" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/msedgewebview2/ -->
			<OriginalFileName condition="contains">msedgewebview2.exe</OriginalFileName>
			<CommandLine condition="contains all">--no-sandbox;--renderer-cmd-prefix</CommandLine>
		</Rule>		
		<Rule name="technique_id=T1098,technique_name=Account Manipulation - Mimikatz Commands" groupRelation="and"> <!--REF: https://happycamper84.medium.com/mimikatz-cheatsheet-ad2b88059b4 -->
			<OriginalFileName condition="contains">mimikatz.exe</OriginalFileName>
			<CommandLine condition="contains any">kerberos;golden;lsadump;dcsync;token;elevate;privilege;debug;sekurlsa;logonpasswords;credman;vault;cred;sam;cache;tickets</CommandLine>
		</Rule>	
		<Rule name="technique_id=T1070.001,technique_name=Clear Windows Event Logs - wevtutil" groupRelation="and"> <!--Windows - Clear event logs-->
				<OriginalFileName condition="image">wevtutil.exe</OriginalFileName>
				<CommandLine condition="contains"> cl </CommandLine>
				<CommandLine condition="excludes">wevtutil im</CommandLine>
				<CommandLine condition="excludes">wevtutil.exe im</CommandLine>
				<CurrentDirectory condition="excludes">ClickToRun</CurrentDirectory>
			</Rule>
		<Image name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - Aspnet_Compiler" condition="end with">\aspnet_compiler.exe</Image>  <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Aspnet_Compiler/ -->
		<Image name="technique_id=T1053.002,technique_name=LOLBAS Scheduled Task/Job - AT" condition="end with">\at.exe</Image>  <!-- Remark: The AT command has been deprecated - REF: https://lolbas-project.github.io/lolbas/Binaries/At/ -->
		<OriginalFileName name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Bash" condition="is">bash.exe</OriginalFileName>  <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Bash/-->
		<OriginalFileName name="technique_id=T1036.005,technique_name=LOLBAS Match Legitimate Name or Location - Colorcpl" condition="is">Colorcpl.exe</OriginalFileName> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Colorcpl/ -->
		<OriginalFileName name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Extexport" condition="is">Extexport.exe</OriginalFileName> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Extexport/ -->
	<!--Known BAD-->		
		<Rule name="technique_id=T1003.001,technique_name=LOLBAS LSASS Memory - sqldumper" groupRelation="and"> <!--REF: https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqldumper/ -->
			<OriginalFileName condition="contains">sqldumper.exe</OriginalFileName>
			<CommandLine condition="contains">0x</CommandLine>
		</Rule>
		<Rule name="technique_id=S0552,technique_name=TOOL - AdFind" groupRelation="and"> <!--REF: https://attack.mitre.org/software/S0552/ -->
			<OriginalFileName condition="contains">AdFind.exe</OriginalFileName>
			<CommandLine condition="contains">-</CommandLine>
		</Rule>	
		<Rule name="technique_id=S0552,technique_name=TOOL - PCHunter" groupRelation="and"> <!--REF:https://www.majorgeeks.com/files/details/pc_hunter.html Used by Akira Ransomware -->
			<OriginalFileName condition="contains">PCHunter.exe</OriginalFileName>
		</Rule>
		<Image name="technique_id=S0552,technique_name=TOOL - LaZagne" condition="image">LaZagne.exe</Image> <!--REF:https://github.com/AlessandroZ/LaZagne Used by Akira Ransomware -->
	<!--Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">query.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">tasklist.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="image">qprocess.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">query.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">qwinsta.exe</OriginalFileName> <!--Process Creation Process Discovery-->
        <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">rwinsta.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">PsList.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">PipeList.exe</OriginalFileName> <!--Process Creation Process Discovery-->
		<OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">PsInfo.exe</OriginalFileName> <!--Process Creation Process Discovery-->
	<!-- Owner/User Discovery-->	
		<OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">whoami.exe</OriginalFileName>		   
        <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains any">systeminfo.exe;sysinfo.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">quser.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains any">nltest.exe;nltestk.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">PsGetSID.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">PsLoggedOn.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">LogonSessions.exe</OriginalFileName>
	<!-- System Network Configuration Discovery-->
		<OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">ipconfig.exe</OriginalFileName>		
        <OriginalFileName name="technique_id=T1049,technique_name=System Network Connections Discovery" condition="is">netstat.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">nslookup.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">route.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">tracert.exe</OriginalFileName>		
	<!-- File and Directory Discovery-->
		<OriginalFileName name="technique_id=T1083,technique_name=File and Directory Discovery" condition="is">tree.com</OriginalFileName>
        <OriginalFileName name="technique_id=T1083,technique_name=File and Directory Discovery" condition="is">AccessChk.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1083,technique_name=File and Directory Discovery" condition="is">AccessEnum.exe</OriginalFileName>		
	<!-- Other -->	
        <OriginalFileName name="technique_id=T1136,technique_name=Create Account" condition="contains any">net.exe;net1.exe;net2.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1134,technique_name=Access Token Manipulation" condition="is">runas.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1112,technique_name=Modify Registry" condition="is">reg.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1489,technique_name=Service Stop" condition="is">taskkill.exe</OriginalFileName> <!-- https://thedfirreport.com/2020/10/08/ryuks-return/ -->
        <OriginalFileName name="technique_id=T1063,technique_name=Security Software Discovery" condition="is">netsh.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1087,technique_name=Account Discovery" condition="is">klist.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1053,technique_name=Scheduled Task" condition="is">taskeng.exe</OriginalFileName>
        <ParentImage name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="image">wmiprvse.exe</ParentImage>
        <OriginalFileName name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">wmiprvse.exe</OriginalFileName>
		<Image name="technique_id=T1548,technique_name=Abuse Elevation Control Mechanism - sudo.exe" condition="image">sudo.exe</Image> <!--REF: https://devblogs.microsoft.com/commandline/introducing-sudo-for-windows/-->		
	<!--Kerio Connect Kassist dump tool-->
		<Rule name="technique_id=T1003,technique_name=OS Credential Dumping - Kerio Connect Kassist" groupRelation="and"> <!--Kerio Connect Kassist-->
			<Image condition="image">kassist.exe</Image>
			<CommandLine condition="contains any">-q;-s;-d;-b;-g;-U;ftp:;-u;-p;-D;-e;-n;-f</CommandLine>
		</Rule>		
    <!--Command-Line Interface CMD LOLBAS -->
        <OriginalFileName name="technique_id=T1059,technique_name=LOLBAS Command-Line Interface - cmd" condition="is">cmd.exe</OriginalFileName> <!--https://lolbas-project.github.io/lolbas/Binaries/Cmd/-->
        <ParentImage name="technique_id=T1059,technique_name=LOLBAS Command-Line Interface - cmd" condition="image">cmd.exe</ParentImage> <!--https://lolbas-project.github.io/lolbas/Binaries/Cmd/-->
	<!--Command-Line Interface PowerShell-->	
        <Image name="technique_id=T1086,technique_name=PowerShell" condition="image">powershell.exe</Image>
		<ParentImage name="technique_id=T1086,technique_name=PowerShell" condition="image">powershell.exe</ParentImage>
        <ParentImage name="technique_id=T1086,technique_name=PowerShell - ise" condition="image">powershell_ise.exe</ParentImage>		
	<!--Indirect Command Execution-->
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="image">pcalua.exe</Image>
		<OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">winrs.exe</OriginalFileName>
		<ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="image">pcalua.exe</ParentImage>
        <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="image">control.exe</ParentImage>
		<Image name="technique_id=T1079,technique_name=Traffic traversing TOR Network" condition="image">tor.exe</Image>        
        <OriginalFileName name="technique_id=T1073,technique_name=DLL Side-Loading" condition="is">odbcconf.exe</OriginalFileName>
        <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="image">control.exe</ParentImage>
        <OriginalFileName name="technique_id=T1158,technique_name=Hidden Files and DirectoriesHidden Files and Directories" condition="is">attrib.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1053,technique_name=Scheduled Tasks" condition="contains any">schtasks.exe;sctasks.exe</OriginalFileName>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">jjs.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="image">appcmd.exe</Image>
        <OriginalFileName name="technique_id=T1031,technique_name=Modify Existing Service" condition="is">sc.exe</OriginalFileName>        
        <OriginalFileName name="technique_id=T1081,technique_name=Credentials in Files" condition="is">where.exe</OriginalFileName>
        <Image name="technique_id=T1222,technique_name=File Permissions Modification" condition="image">forfiles.exe</Image>
        <OriginalFileName name="technique_id=T1222,technique_name=File Permissions Modification" condition="contains any">icacls.exe;cacls.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1074,technique_name=Data Staged" condition="is">xcopy.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1074,technique_name=Data Staged" condition="is">robocopy.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1222,technique_name=File Permissions Modification" condition="is">takeown.exe</OriginalFileName>
        <OriginalFileName name="technique_id=M1051,technique_name=Update Software" condition="is">wusa.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">vassadmin.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1088,technique_name=Bypass User Account Control" condition="is">computerdefaults.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1088,technique_name=Bypass User Account Control" condition="is">dism.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">mofcomp.exe</OriginalFileName>
        <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
    <!--Dosfuscation-->
		<CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">^</CommandLine> <!--Process start with commandline Character Insertion Obfuscation-->
		<CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">../../</CommandLine> <!--Process start with commandline Character Insertion Obfuscation-->
        <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities" condition="is">MSBuild.exe</OriginalFileName>
	<!--Office Application Startup-->
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">excel.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">winword.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">powerpnt.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">outlook.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">msaccess.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">mspub.exe</ParentImage>
		<ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">OneNote.exe</ParentImage>
		<ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="image">OneNotem.exe</ParentImage>	
        <OriginalFileName name="technique_id=T1007,technique_name=System Service Discovery" condition="is">PsService.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1035,technique_name=Service Execution" condition="is">PsExec.exe</OriginalFileName>
		<OriginalFileName name="technique_id=T1035,technique_name=Service Execution" condition="is">PsExec64.exe</OriginalFileName>																													 
        <OriginalFileName name="technique_id=T1035,technique_name=Service Execution" condition="is">PsExec.c</OriginalFileName>
		<OriginalFileName name="technique_id=T1035,technique_name=Service Execution - Net Tcp Port Sharing Service" condition="is">SMSvcHost.exe</OriginalFileName> <!--Net Tcp Port Sharing Service-->
        <OriginalFileName name="technique_id=T1089,technique_name=Disabling Security Tools" condition="is">PsKill.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1089,technique_name=Disabling Security Tools" condition="is">PKill.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1105,technique_name=Remote File Copy" condition="image">PsFile.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1088,technique_name=Bypass User Account Control" condition="contains">ShellRunas</OriginalFileName>
        <OriginalFileName name="technique_id=T1005,technique_name=Data from Local System" condition="is">PsLogList.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1007,technique_name=System Service Discovery" condition="contains">LoadOrd</OriginalFileName>
        <OriginalFileName name="technique_id=T1098,technique_name=Account Manipulation" condition="is">PsPasswd.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1012,technique_name=Query Registry" condition="is">ru.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1012,technique_name=Query Registry" condition="contains">Regsize</OriginalFileName>
	 <!--Uncommon locations process start locations-->
        <Image name="technique_id=T1036,technique_name=Masquerading - PerfLogs" condition="begin with">C:\PerfLogs\</Image> <!-- Process Creation from PerfLogs Folder-->
        <Image name="technique_id=T1036,technique_name=Masquerading - Recycle.bin" condition="begin with">C:\$Recycle.bin\</Image> <!-- Process Creation from Recyclebin Folder-->
        <Image name="technique_id=T1036,technique_name=Masquerading - Intel Logs" condition="begin with">C:\Intel\Logs\</Image> <!-- Process Creation from Intel Logs Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Users Default" condition="begin with">C:\Users\Default\</Image> <!-- Process Creation from Users default Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Users Public" condition="begin with">C:\Users\Public\</Image> <!-- Process Creation from Users Public Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Users NetworkService" condition="begin with">C:\Users\NetworkService\</Image> <!-- Process Creation from Users NetworkService Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Fonts" condition="begin with">C:\Windows\Fonts\</Image> <!-- Process Creation from Windows Fonts Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Debug" condition="begin with">C:\Windows\Debug\</Image> <!-- Process Creation from Windows Debug Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Media" condition="begin with">C:\Windows\Media\</Image> <!-- Process Creation from Windows Media Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Help" condition="begin with">C:\Windows\Help\</Image> <!-- Process Creation from Windows Help Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - addins" condition="begin with">C:\Windows\addins\</Image> <!-- Process Creation from Windows addins Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - repair" condition="begin with">C:\Windows\repair\</Image> <!-- Process Creation from Windows repair Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - security" condition="begin with">C:\Windows\security\</Image> <!-- Process Creation from Windows Security Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - systemprofile" condition="begin with">C:\Windows\system32\config\systemprofile\</Image> <!-- Process Creation from system32 config systemprofile Folder -->
        <Image name="technique_id=T1036,technique_name=Masquerading - VolumeShadowCopy" condition="contains">VolumeShadowCopy</Image> <!-- Process Creation from VolumeShadowCopy -->
        <Image name="technique_id=T1036,technique_name=Masquerading - htdocs" condition="contains">\htdocs\</Image> <!-- Process Creation from htdocs -->
        <Image name="technique_id=T1036,technique_name=Masquerading - wwwroot" condition="contains">\wwwroot\</Image> <!-- Process Creation from wwwroot -->
        <Image name="technique_id=T1036,technique_name=Masquerading - Temp" condition="contains">\Temp\</Image> <!-- Process Creation fromall Temp Folders -->
		<Image name="technique_id=T1036,technique_name=Masquerading - Task" condition="begin with">C:\Windows\Tasks\</Image> <!-- Process Creation from Windows Task Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Intel" condition="begin with">C:\Intel\</Image> <!-- Process Creation from c Intel Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - AppReadiness" condition="begin with">C:\Windows\AppReadiness\> </Image> <!-- Process Creation from AppReadiness Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - IdentityCRL" condition="begin with">C:\Windows\IdentityCRL\></Image> <!-- Process Creation from Windows IdentityCRL Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Branding" condition="begin with">C:\Windows\Branding\></Image> <!-- Process Creation from Windows Branding Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - DigitalLocker" condition="begin with">C:\Windows\DigitalLocker\></Image> <!-- Process Creation from Windows DigitalLocker Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - en-US" condition="begin with">C:\Windows\en-US\></Image> <!-- Process Creation from Windows en-US Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Prefetch" condition="begin with">C:\Windows\Prefetch\></Image> <!-- Process Creation from Windows Prefetch Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - diagnostics" condition="begin with">C:\Windows\diagnostics\></Image> <!-- Process Creation from Windows diagnostics Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - TAPI" condition="begin with">C:\Windows\TAPI\></Image> <!-- Process Creation from Windows TAPI Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - INF" condition="begin with">C:\Windows\INF\></Image> <!-- Process Creation from Windows INF Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - tracing" condition="begin with">C:\windows\tracing\></Image> <!-- Process Creation from Windows tracing Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - IME" condition="begin with">C:\windows\IME\></Image> <!-- Process Creation from Windows IME Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Performance" condition="begin with">C:\Windows\Performance\></Image> <!-- Process Creation from Windows Performance Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - ServiceProfiles" condition="begin with">C:\Windows\ServiceProfiles\></Image> <!-- Process Creation from Windows ServiceProfiles Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - panther" condition="begin with">C:\Windows\panther\></Image> <!-- Process Creation from Windows panther Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - RemotePackages" condition="begin with">C:\Windows\RemotePackages\></Image> <!-- Process Creation from Windows RemotePackages Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - OCR" condition="begin with">C:\Windows\OCR\></Image> <!-- Process Creation from Windows OCR Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - appcompat" condition="begin with">C:\Windows\appcompat\></Image> <!-- Process Creation from Windows appcompat Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - apppatch" condition="begin with">C:\Windows\apppatch\></Image> <!-- Process Creation from Windows apppatch Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - SKB" condition="begin with">C:\Windows\SKB\></Image> <!-- Process Creation from Windows SKB Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Web" condition="begin with">C:\Windows\Web\></Image> <!-- Process Creation from Windows Web Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Vss" condition="begin with">C:\Windows\Vss\></Image> <!-- Process Creation from Windows Vss Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - CbsTemp" condition="begin with">C:\Windows\CbsTemp\></Image> <!-- Process Creation from Windows CbsTemp Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Logs" condition="begin with">C:\Windows\Logs\></Image> <!-- Process Creation from Windows Logs Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - WaaS" condition="begin with">C:\Windows\WaaS\></Image> <!-- Process Creation from Windows WaaS Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - twain_32" condition="begin with">C:\Windows\twain_32\></Image> <!-- Process Creation from Windows twain_32 Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - PLA" condition="begin with">C:\Windows\PLA\></Image> <!-- Process Creation from Windows PLA Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Migration" condition="begin with">C:\Windows\Migration\></Image> <!-- Process Creation from Windows Migration Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Cursors" condition="begin with">C:\Windows\Cursors\></Image> <!-- Process Creation from Windows Cursors Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Containers" condition="begin with">C:\Windows\Containers\></Image> <!-- Process Creation from Windows Containers Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - bcastdvr" condition="begin with">C:\Windows\bcastdvr\></Image> <!-- Process Creation from Windows bcastdvr Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - assembly" condition="begin with">C:\Windows\assembly\></Image> <!-- Process Creation from Windows assembly Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - TextInput" condition="begin with">C:\Windows\TextInput\></Image> <!-- Process Creation from Windows TextInput Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - schemas" condition="begin with">C:\Windows\schemas\></Image> <!-- Process Creation from Windows schemas Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - SchCache" condition="begin with">C:\Windows\SchCache\></Image> <!-- Process Creation from Windows SchCache Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Resources" condition="begin with">C:\Windows\Resources\></Image> <!-- Process Creation from Windows Resources Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - rescache" condition="begin with">C:\Windows\rescache\></Image> <!-- Process Creation from Windows rescache Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Provisioning" condition="begin with">C:\Windows\Provisioning\></Image> <!-- Process Creation from Windows Provisioning Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - PolicyDefinitions" condition="begin with">C:\Windows\PolicyDefinitions\></Image> <!-- Process Creation from Windows PolicyDefinitions Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Globalization" condition="begin with">C:\Windows\Globalization\></Image> <!-- Process Creation from Windows Globalization Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - L2Schemas" condition="begin with">C:\Windows\L2Schemas\></Image> <!-- Process Creation from Windows L2Schemas Folder-->
		<Image name="technique_id=T1036,technique_name=Masquerading - ModemLogs" condition="begin with">C:\Windows\ModemLogs\></Image> <!-- Process Creation from Windows ModemLogs Folder-->
	<!--Monitor for processes starting from onedrive folders-->
		<Image name="technique_id=T1036,technique_name=Masquerading - Onedrive Folder" condition="contains">\OneDrive></Image> <!-- Process Creation from Onedrive Folder-->
	<!--User Execution-->
		<Image name="technique_id=T1204,technique_name=User_Execution - Desktop" condition="contains all">\Users\;\Desktop</Image> <!-- User_Execution from Desktop-->
		<Image name="technique_id=T1204,technique_name=User_Execution - Startup" condition="contains">\Microsoft\Windows\Start Menu\Programs\Startup\</Image> <!-- User Execution from Startup Folder-->
		<Image name="technique_id=T1204,technique_name=User_Execution - INetCache" condition="contains">\AppData\Local\Microsoft\Windows\INetCache\</Image> <!-- User Execution from INetCache Folder-->
		<Image name="technique_id=T1204,technique_name=User_Execution - AppData" condition="contains all">\Users\;\AppData</Image> <!-- User Execution from AppData Folder-->
		<Image name="technique_id=T1204,technique_name=User_Execution - Users" condition="is">C:\Users</Image> <!-- User Execution from Users Folder-->		
     <!--Control Panel Items-->
		<Rule name="technique_id=T1196,technique_name=Control Panel Items" groupRelation="or">
          <CommandLine condition="contains all">control;/name</CommandLine>
          <CommandLine condition="contains all">rundll32.exe;shell32.dll;Control_RunDLL</CommandLine>
        </Rule>
	<!--Windows Defender tampering-->
        <Rule name="Windows Defender tampering" groupRelation="and">
          <Image name="technique_id=T1089,technique_name=Disabling Security Tools" condition="image">MpCmdRun.exe</Image>
          <CommandLine name="technique_id=T1089,technique_name=Disabling Security Tools" condition="contains any">Add-MpPreference;RemoveDefinitions;DisableIOAVProtection</CommandLine>
        </Rule>
	<!--Windows Remote Management-->
        <OriginalFileName name="technique_id=T1028,technique_name=Windows Remote Management" condition="is">wsmprovhost.exe</OriginalFileName>
        <Image name="technique_id=T1028,technique_name=Windows Remote Management" condition="image">winrm.cmd</Image>
	<!--Cobalt Strike Privilege Escalation-->
		<Rule name="technique_id=S0154,technique_name=Cobalt Strike - Pipe" groupRelation="and"> <!--Cobalt Strike Iron Rule-->
			<Image condition="image">cmd.exe</Image>
			<CommandLine condition="contains all">echo;\pipe\;&gt;</CommandLine>
		</Rule>
		<Rule name="technique_id=S0154,technique_name=Cobalt Strike - Copy" groupRelation="and"> <!--Cobalt Strike Iron Rule-->
			<Image condition="image">cmd.exe</Image>
			<CommandLine condition="contains all">/c;copy;dll;\\;admin$</CommandLine>
		</Rule>
		<Rule name="technique_id=S0154,technique_name=Cobalt Strike - Startw" groupRelation="and"> <!--Cobalt Strike Iron Rule - Trickbot-->
			<Image condition="image">rundll32.exe</Image>
			<CommandLine condition="contains all">,;StartW</CommandLine>
		</Rule>
		<Rule name="technique_id=S0154,technique_name=Cobalt Strike - Update" groupRelation="and"> <!--Cobalt Strike Iron Rule-->
			<Image condition="image">rundll32.exe</Image>
			<CommandLine condition="contains all">,;update;appdata;temp;/i:</CommandLine>
		</Rule>		
		<Rule name="technique_id=S0154,technique_name=Cobalt Strike - Update Temp1" groupRelation="and"> <!--Cobalt Strike Iron Rule-->
			<Image condition="image">rundll32.exe</Image>
			<CommandLine condition="contains all">,;update;appdata;temp;-i:</CommandLine>
		</Rule>
      </ProcessCreate>
     </RuleGroup>
<!-- Event ID 2 == A process changed a file creation time -->
	<RuleGroup name="TimeStomp" groupRelation="or">
      <FileCreateTime onmatch="exclude">
		<Image condition="end with">\AppData\Local\Google\Chrome\Application\chrome.exe</Image> <!--Microsoft:Windows: Excluded chrome -->
		<Image condition="end with">\AppData\Local\Microsoft\Teams\current\Teams.exe</Image> <!--Microsoft:Windows: Excluded Teams -->
		<Image condition="end with">\AppData\Local\Programs\mattermost-desktop\Mattermost.exe</Image> <!--Microsoft:Windows: Excluded Mattermost -->
		<Image condition="end with">\AppData\Local\Programs\Microsoft VS Code\Code.exe</Image> <!--Microsoft:Windows: Microsoft VS Code -->
		<Image condition="end with">\WINDOWS\system32\cleanmgr.exe</Image> <!--Microsoft:Windows: Microsoft cleanmgr -->
		<Image condition="end with">\Program Files\Mozilla Firefox\firefox.exe</Image> <!--Microsoft:Windows: Mozilla Firefox -->
		<Image condition="end with">\Microsoft\Edge\Application\msedge.exe</Image> <!--Microsoft:Windows: Edge Browser -->
		<Image condition="end with">\Program Files\LibreOffice\program\soffice.bin</Image> <!--Microsoft:Windows: Libre Office -->
		<Image condition="end with">\Windows\system32\backgroundTaskHost.exe</Image> <!--Microsoft:Windows: Back Ground Task Host -->
		<Image condition="end with">\WINDOWS\system32\ProvTool.exe</Image> <!--Microsoft:Windows: Prov Tool -->
		<Image condition="end with">\Windows\system32\wuauclt.exe</Image> <!--Microsoft:Windows Update AutoUpdate Client -->
		<Image condition="contains">setup</Image> <!--Microsoft:Windows: All installers with the name setup in them -->
		<Image condition="begin with">C:\$WinREAgent\Scratch</Image> <!-- Microsoft Windows Update-->
		<Image condition="begin with">C:\$WINDOWS.~BT</Image> <!-- Microsoft Windows Update-->
		<Image condition="begin with">C:\$Windows.~WS</Image> <!-- Microsoft Windows Update-->
		<Image condition="begin with">C:\Program Files (x86)\Microsoft\EdgeUpdate\Install</Image> <!-- Microsoft Windows Edge Update-->
		<Image condition="begin with">C:\Program Files (x86)\Microsoft\EdgeWebView\Application</Image> <!-- Microsoft Windows Edge Update-->
		<Image condition="begin with">C:\Windows\SoftwareDistribution</Image> <!-- Microsoft Windows Update-->
		</FileCreateTime>
     </RuleGroup>
<!-- Event ID 3 == Network Connection - Excluded -->
	<RuleGroup name="Network Connection" groupRelation="or">
		<NetworkConnect onmatch="exclude">
		<Image condition="end with">\Microsoft\Teams\current\Teams.exe</Image> <!-- MS Teams - Masquerading excluded -->
		<Image condition="end with">\Microsoft\Teams\Update.exe</Image> <!-- MS Teams updater - Masquerading excluded -->
		<Image condition="end with">\AppData\Local\Microsoft\OneDrive\Update\OneDriveSetup.exe</Image> <!-- MS Onedrive - Masquerading updater excluded -->
		<Image condition="end with">\AppData\Local\Microsoft\OneDrive\OneDrive.exe</Image> <!-- MS Onedrive - Masquerading standalone updater excluded -->
		<Image condition="end with">\Microsoft.SharePoint.exe</Image> <!-- MS SharePoint - Masquerading excluded -->
		<Image condition="end with">\SuperOffice.TrayApp.Client.exe</Image> <!-- SuperOffice - Masquerading excluded -->
		<Image condition="image">slack.exe</Image> <!-- Slack - Masquerading excluded  -->
		<Image condition="end with">winlogbeat.exe</Image> <!--Elastic winlogbeat -->
        <Image condition="end with">packetbeat.exe</Image> <!--Elastic packetbeat -->
	<!--Exclude Windows Update-->
		<DestinationHostname condition="end with">.windowsupdate.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">.windowsupdate.com</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">wustat.windows.com</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">go.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">.update.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">download.microsoft.com</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">microsoft.com.akadns.net</DestinationHostname> <!--Microsoft:Update delivery-->
		<DestinationHostname condition="end with">microsoft.com.nsatc.net</DestinationHostname>	<!--Microsoft:Update delivery-->
	<!--Exclude Windows components-->
		<Rule groupRelation="and">
			<Protocol name="Exclude msedge UDP Protocol" condition="is">udp</Protocol> <!--Exclude msedge UDP-->
			<Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image>															
		</Rule>
		<Rule groupRelation="and">
			<DestinationHostname name="Exclude msedge Akamai" condition="end with">.akamaitechnologies.com</DestinationHostname>
			<Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image>																		
		</Rule>
	<!--Exclude local IP -->
		<Rule name="Exclude msedge Akamai" groupRelation="and">
			<DestinationIp condition="contains any">::1;0.0.0.0</DestinationIp>
		</Rule>	
	</NetworkConnect>
	</RuleGroup>
<!-- Event ID 3 == Network Connection. -->
	<RuleGroup name="" groupRelation="or">
      <NetworkConnect onmatch="include">
	<!--System Network Configuration Discovery -->
        <Image name="technique_id=T1016,technique_name=System Network Configuration Discovery - ipconfig" condition="image">ipconfig.exe</Image> <!--Microsoft:Windows: shows ip configuration -->
        <Image name="technique_id=T1016,technique_name=System Network Configuration Discovery - nslookup.exe" condition="image">nslookup.exe</Image> <!--Microsoft:Windows: shows DNS configuration and enables quering -->
		<Image name="technique_id=T1016,technique_name=System Network Configuration Discovery - nbtstat" condition="image">nbtstat.exe</Image> <!--Microsoft:Windows: NetBIOS statistics, attackers use to enumerate local network -->
    <!--System Network Connections Discovery -->
		<Image name="technique_id=T1049,technique_name=System Network Connections Discovery - netstat.exe" condition="image">netstat.exe</Image>  <!--Microsoft:Windows: shows protocol statistics and current TCP/IP network connections -->
    <!--Process Discovery -->
		<Image name="technique_id=T1057,technique_name=Process Discovery - tasklist" condition="image">tasklist.exe</Image> <!--Microsoft:Windows: shows current running processes-->
        <Image name="technique_id=T1057,technique_name=Process Discovery - qprocess" condition="image">qprocess.exe</Image> <!--Microsoft:Windows: shows information about processes -->
		<Image name="technique_id=T1057,technique_name=Process Discovery - query" condition="image">query.exe</Image> <!--Microsoft:Windows: shows information about processes -->
		<Image name="technique_id=T1057,technique_name=Process Discovery - qwinsta" condition="image">qwinsta.exe</Image> <!--Microsoft:Windows: Remotely query login sessions on a server or workstation | Credit @ion-storm -->
        <Image name="technique_id=T1057,technique_name=Process Discovery - rwinsta.exe" condition="image">rwinsta.exe</Image> <!--Microsoft:Windows: Disconnect remote sessions | Credit @ion-storm -->
	<!--Indirect Command Execution -->
	    <Image name="technique_id=T1202,technique_name=Indirect Command Execution - pcalua" condition="image">pcalua.exe</Image> <!--Microsoft:Windows: Program Compatibility Assistant)-->
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution - winrs" condition="image">winrs.exe</Image>		
    <!--Signed Binary Proxy Execution -->
		<Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution - Msdt" condition="image">Msdt.exe</Image> <!--https://lolbas-project.github.io/lolbas/Binaries/Msdt/-->
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution - RegisterCimProvider" condition="image">RegisterCimProvider.exe</Image>
		<Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution - Mavinject" condition="image">Mavinject.exe</Image>		
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="image">dfsvc.exe</Image> <!--https://lolbas-project.github.io/lolbas/Binaries/Dfsvc/-->
	<!--PowerShell -->
		<Image name="technique_id=T1059.001,technique_name=PowerShell - powershell" condition="image">powershell.exe</Image> <!--Microsoft:Windows: PowerShell interface-->
	    <Image name="technique_id=T1059.001,technique_name=PowerShell - OpenConsole" condition="image">OpenConsole.exe</Image> <!--Microsoft Windows Terminal-->
        <Image name="technique_id=T1059.001,technique_name=PowerShell - WindowsTerminal" condition="image">WindowsTerminal.exe</Image> <!--Microsoft Windows Terminal-->		 
	<!--Other -->
        <Image name="technique_id=T1033,technique_name=System Owner/User Discovery - quser" condition="image">quser.exe</Image> <!--Microsoft:Windows: shows logged-on users -->
        <Image name="technique_id=T1134,technique_name=Access Token Manipulation - runas" condition="image">runas.exe</Image> <!--Microsoft:Windows: run a process as another user -->
        <Image name="technique_id=T1112,technique_name=Modify Registry - reg" condition="image">reg.exe</Image> <!--Microsoft:Windows: reads and modifies the Windows register -->
        <Image name="technique_id=T1518.001,technique_name=Security Software Discovery - netsh" condition="image">netsh.exe</Image> <!--Microsoft:Windows: manipulate the firewall -->
        <Image name="technique_id=T1550.003,technique_name=Use Alternate Authentication Material: Pass the Ticket - Klist remote" condition="image">klist.exe</Image> <!--Microsoft:Windows: show cached kerberos tickets -->
		<Image name="technique_id=T1053,technique_name=Scheduled Task/Job - taskeng" condition="image">taskeng.exe</Image>  <!--Microsoft:Windows: taskscheduler -->
        <Image name="technique_id=T1069,technique_name=Permission Groups Discovery - net1" condition="image">net1.exe</Image>  <!--Microsoft:Windows: Launched by "net.exe", but it may not detect connections either -->
        <Image name="technique_id=T1543.003,technique_name=Windows Service - sc" condition="image">sc.exe</Image> <!--Microsoft:Service Configuration Tool-->
        <Image name="technique_id=T1033,technique_name=System Owner/User Discovery - nltest" condition="image">nltest.exe</Image>  <!-- netlogon testing utility-->
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution - dfsvc" condition="image">dfsvc.exe</Image>  <!--https://lolbas-project.github.io/lolbas/Binaries/Dfsvc/-->
        <Image name="technique_id=T1055,technique_name=Process Injection - winlogon" condition="image">winlogon.exe</Image> <!--https://www.microsoft.com/en-us/security/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign/ -->
		<Image name="technique_id=T1048,technique_name=Net Tcp Port Sharing service" condition="image">SMSvcHost.exe</Image> <!-- Net Tcp Port Sharing service -->
		<Image name="technique_id=T1557,technique_name=Credential Access - Kerio Connect Dump" condition="image">kassist.exe</Image> <!-- Kerio Connect Dump - PW Dump -->
	<!--Sysinternals -->
		<Image name="technique_id=T1035,technique_name=Service Execution - psexec" condition="image">psexec.exe</Image>
		<Image name="technique_id=T1035,technique_name=Service Execution - PsExec64" condition="image">PsExec64.exe</Image>
        <Image name="technique_id=T1035,technique_name=Service Execution - psexesvc" condition="image">psexesvc.exe</Image>
	<!--Tor Browser -->
		<Image name="technique_id=T1573,technique_name=Encrypted Channel - TOR" condition="image">tor.exe</Image> <!-- TOR Browser -->
	<!-- LOLBAS Tools -->
		<Image name="technique_id=T1218,technique_name=LOLBAS Ingress Tool Transfer - AddInutil" condition="end with">\AddInutil.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Addinutil/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - AppInstaller" condition="image">AppInstaller.exe</Image> <!-- REF: https://lolbas-project.github.io/ Multiple options-->
		<Image name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - Aspnet_Compiler" condition="end with">\aspnet_compiler.exe</Image>  <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Aspnet_Compiler/ -->
		<Image name="technique_id=T1053.002,technique_name=LOLBAS Scheduled Task/Job - AT" condition="end with">\at.exe</Image>  <!-- Remark: The AT command has been deprecated - REF: https://lolbas-project.github.io/lolbas/Binaries/At/ -->
		<Image name="technique_id=T1202,technique_name=LOLBAS Indirect Command Execution - Bash" condition="image">bash.exe</Image>  <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/Bash/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Wsl" condition="image">Wsl.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/OtherMSBinaries/Wsl/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Bitsadmin" condition="image">bitsadmin.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - CertOC" condition="image">CertOC.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Certoc/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - CertReq" condition="image">CertReq.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Certreq/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - cmd" condition="image">cmd.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmd/ Multiple options-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - cmdl32" condition="image">cmdl32.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmdl32/-->
		<Image name="technique_id=T1218.003,technique_name=LOLBAS CMSTP - CMSTP" condition="image">CMSTP.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Cmstp/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - ConfigSecurityPolicy" condition="image">ConfigSecurityPolicy.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/ConfigSecurityPolicy/-->
		<Image name="technique_id=T1567,technique_name=LOLBAS Exfiltration Over Web Service - DataSvcUtil" condition="image">DataSvcUtil.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/DataSvcUtil/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - desktopimgdownldr" condition="image">desktopimgdownldr.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Desktopimgdownldr/-->
		<Image name="technique_id=T1543.003,technique_name=LOOLBAS Windows Service - dnscmd" condition="image">dnscmd.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Findstr" condition="image">Findstr.exe</Image> <!--REF:  https://lolbas-project.github.io/lolbas/Binaries/Findstr/ Multiple options-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Finger" condition="image">Finger.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Finger/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - FTP" condition="image">FTP.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ftp/-->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - IMEWDBLD" condition="image">IMEWDBLD.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/IMEWDBLD/-->		
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - IEExec" condition="image">IEExec.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ieexec/ -->
		<Image name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Infdefaultinstall" condition="image">Infdefaultinstall.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Infdefaultinstall/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - ldifde" condition="image">ldifde.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Ldifde/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Makecab" condition="image">Makecab.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Makecab/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - MpCmdRun" condition="image">MpCmdRun.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/MpCmdRun/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Mshta" condition="image">Mshta.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Mshta/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Msiexec" condition="image">Msiexec.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msiexec/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - OneDriveStandaloneUpdater" condition="image">OneDriveStandaloneUpdater.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/OneDriveStandaloneUpdater/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Pcalua" condition="image">Pcalua.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Pcalua/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Presentationhost" condition="image">Presentationhost.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Presentationhost/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - print - Can download from webdav" condition="image">print.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Print/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - PrintBrm" condition="image">PrintBrm.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/PrintBrm/ - zipping and unzipping arbitrary files with UNC path -->
		<Image name="technique_id=T1218.010,technique_name=LOLBAS Regsvr32 - Regsvr32" condition="image">Regsvr32.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Regsvr32/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Replace" condition="image">Replace.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Replace/ -->
		<Image name="technique_id=T1003,technique_name=LOLBAS OS Credential Dumping - Rpcping" condition="image">Rpcping.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Rpcping/ -->
		<Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution - ScriptRunner" condition="image">ScriptRunner.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Scriptrunner/ -->
		<Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution - SyncAppvPublishingServer" condition="image">SyncAppvPublishingServer.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - TAR Remote files" condition="image">tar.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Tar/ -->		
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - winget" condition="image">winget.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Winget/ -->
		<Image name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - Wmic" condition="image">Wmic.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wmic/ -->	
		<Image name="technique_id=T1564.004,technique_name=LOLBAS NTFS File Attributes - Wscript" condition="image">Wscript.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Wscript/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Xwizard" condition="image">Xwizard.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Xwizard/ -->
		<Image name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - Microsoft Edge Browser Proxy" condition="image">msedge_proxy.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/msedge_proxy/ -->
	<!-- Common Misused tools -->
		<Image name="Office Application Onenote network connection - onenote" condition="image">onenote.exe</Image> <!-- OneNote documents to infect computers -->
		<Image name="technique_id=T1055,technique_name=Process Injection - Microsoft Notepad" condition="image">notepad.exe</Image> <!-- notepad making network connections -->
		<Image name="technique_id=T1055,technique_name=Process Injection - Microsoft Calc" condition="image">calc.exe</Image> <!-- calc making network connections -->
		<Image name="technique_id=T1105,technique_name=Certutill Ingress Tool Transfer - certutil" condition="image">certutil.exe</Image> <!-- Microsoft:Certificate Services - download and execute programs -->
	<!-- Common hacker remote access GUI tools -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Remote Desktop" condition="image">mstsc.exe</Image> <!-- Microsoft Windows Remote Desktop -->
        <Image name="technique_id=T1219,technique_name=Remote Access Software - Teamviewer" condition="image">teamviewer.exe</Image> <!-- Teamviewer Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Anydesk" condition="image">anydesk.exe</Image> <!-- Anydesk Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - AeroAdmin" condition="image">AeroAdmin.exe</Image> <!-- AeroAdmin Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - AnyViewer" condition="image">RCClient.exe</Image> <!-- AnyViewer Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Desktopnow" condition="image">desktopnow.exe</Image> <!-- Desktopnow Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - IperiusRemote" condition="image">IperiusRemote.exe</Image> <!-- IperiusRemote Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Distant-desktop" condition="is">C:\ProgramData\Distant Desktop\dd.exe</Image> <!-- Distant-desktop Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - GetScreen" condition="is">C:\Program Files\Getscreen.me\getscreen.exe</Image> <!-- GetScreen Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - ShowMyPC3620" condition="end with">\-ShowMyPC3620\tvnserver.exe</Image> <!-- ShowMyPC3620 Remote management tool --> 
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Radmin-Server" condition="image">rserver3.exe</Image> <!-- Radmin-Server Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Radmin-Viewer" condition="image">Radmin.exe</Image> <!-- Radmin-Viewer Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - AmmyyAdmin" condition="image">AA_v3.exe</Image> <!-- AmmyyAdmin Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - ISL-Remote" condition="image">ISL Light.exe</Image> <!-- ISL Light Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - VNC" condition="image">vnc.exe</Image> <!-- VNC Remote management tool -->
        <Image name="technique_id=T1219,technique_name=Remote Access Software - VNC" condition="image">vncviewer.exe</Image> <!-- VNC Remote management tool -->
        <Image name="technique_id=T1219,technique_name=Remote Access Software - VNC" condition="image">vncservice.exe</Image> <!-- VNC Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Rustdesk" condition="image">Rustdesk.exe</Image> <!-- VNC Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - TightVNC - Viewer" condition="image">tvnviewer.exe</Image> <!-- TightVNC Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - TightVNC - Server" condition="image">tvnserver.exe</Image> <!-- TightVNC Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Russian RMS - Client" condition="image">rutserv.exe</Image> <!-- Russian RMS Tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Tailscale" condition="image">tailscale.exe</Image> <!-- Tailscale  -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Tailscaled" condition="image">tailscaled.exe</Image> <!-- Tailscaled  -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - NinjaRMM" condition="image">NinjaRMMAgent.exe</Image> <!-- NinjaRMM Remote admin Tool  -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Atera Agent" condition="image">AteraAgent.exe</Image> <!-- Atera Agent Remote admin Tool  -->
	<!-- Common hacker execution locations -->		
		<Image name="technique_id=T1036,technique_name=Masquerading - Connection from users" condition="begin with">C:\Users</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows temp" condition="begin with">C:\Windows\Temp</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from c temp" condition="begin with">C:\Temp</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from Perlogs" condition="begin with">C:\PerfLogs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from Recycle" condition="begin with">C:\$Recycle.bin\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from Intel logs" condition="begin with">C:\Intel\Logs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from Users default" condition="begin with">C:\Users\Default\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from Users public" condition="begin with">C:\Users\Public\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from Users NetworkService" condition="begin with">C:\Users\NetworkService\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows fonts" condition="begin with">C:\Windows\Fonts\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows debug" condition="begin with">C:\Windows\Debug\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows media" condition="begin with">C:\Windows\Media\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows help" condition="begin with">C:\Windows\Help\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows addins" condition="begin with">C:\Windows\addins\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows repair" condition="begin with">C:\Windows\repair\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from windows security" condition="begin with">C:\Windows\security\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from system32 systemprofile security" condition="begin with">C:\Windows\system32\config\systemprofile\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from htdocs" condition="contains">\htdocs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading - Connection from webserver root" condition="contains">\wwwroot\</Image>
	<!-- Port rules -->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - Proxy Port " condition="is">1080</DestinationPort> <!--Proxy Port-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - Proxy Port" condition="is">3128</DestinationPort> <!--Proxy Port-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - alternative HTTP port" condition="is">8080</DestinationPort> <!--Common alternative HTTP port-->
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services - SSH Port" condition="is">22</DestinationPort> <!--The Secure Shell SSH-->
		<DestinationPort name="technique_id=T1021,technique_name=Remote Services - FTP Port" condition="is">21</DestinationPort> <!--FTP-->
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services - Telnet" condition="is">23</DestinationPort> <!--Telnet-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - SMTP Port" condition="is">25</DestinationPort> <!--Mail SMTP-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - SMTP submission Port" condition="is">587</DestinationPort> <!--Mail SMTP submission-->
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services - Kerio Connection Port" condition="is">8843</DestinationPort> <!--Kerio mailserver-->
		<DestinationPort name="technique_id=T1021,technique_name=Remote Services - Remote Desktop Port" condition="is">3389</DestinationPort> <!--Remote desktop-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - PPTP VPN Port" condition="is">1723</DestinationPort> <!--PPTP VPN-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - L2TP VPN Port" condition="is">1701</DestinationPort> <!-- L2TP VPN-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - IPSec NAT-T Port" condition="is">4500</DestinationPort> <!--IPSec VPN tunneling-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - IPSec IKE Port" condition="is">500</DestinationPort> <!--Ike-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - TOR Port" condition="is">9001</DestinationPort> <!--TOR-->
        <DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - TOR Port" condition="is">9030</DestinationPort> <!--TOR Trojan-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - Modbus Port" condition="is">502</DestinationPort> <!--Modbus port-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - MQTT Port" condition="is">1883</DestinationPort> <!--MQTT Message Queuing Telemetry Transport port-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - MQTT - Encrypted Port" condition="is">8883</DestinationPort> <!--MQTT Message Queuing Telemetry Transport encrypted port-->
		<DestinationPort name="technique_id=T1043,technique_name=Commonly Used Port - TFTP Port" condition="is">69</DestinationPort> <!--TFTP port-->
		<DestinationPort name="technique_id=T1021.006,technique_name=Windows Remote Management - Port" condition="is">5985</DestinationPort> <!--WinRM 2.0 Microsoft Windows Remote Management-->
        <DestinationPort name="technique_id=T1028,technique_name=Windows Remote Management - WinRM 2.0 Port" condition="is">5986</DestinationPort> <!--WinRM 2.0 Microsoft Windows Remote Management-->
	<!-- Group Destination Rules -->
		<Rule name="technique_id=T1496,technique_name=Resource Hijacking - Known Coin Mining ports" groupRelation="and"> <!--Known Coin mining ports-->
			<DestinationPort condition="is any">3333;6641;6642;4444;5555;7777;8333</DestinationPort>
			<SourcePort condition="excludes">53</SourcePort>
			<Protocol condition="excludes">udp</Protocol>			
		</Rule>
	    </NetworkConnect>
		</RuleGroup>
<!-- Event ID 5 == Process Terminated. -->
	<RuleGroup name="" groupRelation="or">
      <ProcessTerminate onmatch="include">
        <Image condition="begin with">C:\Users</Image>
        <Image condition="begin with">C:\Temp</Image>
        <Image condition="begin with">C:\Windows\Temp</Image>
      </ProcessTerminate>
    </RuleGroup>    
<!-- Event ID 6 == Driver Loaded. -->
	<RuleGroup name="" groupRelation="or">
      <DriverLoad onmatch="exclude">
	    <Signature condition="contains">microsoft</Signature> <!--Exclude signed Microsoft drivers-->
		<Signature condition="contains">windows</Signature> <!--Exclude signed Microsoft drivers-->
		<Signature condition="begin with">Intel</Signature> <!--Exclude signed Intel drivers-->
		<Signature condition="begin with">VMware</Signature> <!--Exclude signed VMware drivers-->
		<Signature condition="begin with">Smart Sound Technology</Signature> <!--Exclude signed Smart Sound Technology drivers-->
		<Signature condition="begin with">NVIDIA Corporation</Signature> <!--Exclude signed NVIDIA Corporation drivers-->
		<Signature condition="begin with">Qualcomm Atheros</Signature> <!--Exclude signed Qualcomm Atheros drivers-->
		<Signature condition="begin with">Lenovo</Signature> <!--Exclude signed Qualcomm Atheros drivers-->
		<Signature condition="begin with">Realtek</Signature> <!--Exclude signed Realtek Semiconductor Corp drivers-->
		<Signature condition="begin with">Rivet Networks</Signature> <!--Exclude signed Rivet Networks LLC drivers-->
		<Signature condition="is">ASUSTeK Computer Inc.</Signature> <!--Exclude signed Rivet Networks LLC drivers-->
		<Signature condition="is">Advanced Micro Devices Inc.</Signature> <!--Exclude signed Advanced Micro Devices Inc.-->
		<Signature condition="is">ASMedia Technology Inc.</Signature> <!--Exclude signed ASMedia Technology Inc.s-->
		<Signature condition="is">Razer USA Ltd.</Signature> <!--Exclude signed Razer-->
	  </DriverLoad>
    </RuleGroup>
<!-- Event ID 7 == Image Loaded Exclude -->
	<RuleGroup name="Image Loaded exclude" groupRelation="or">
		<ImageLoad onmatch="exclude">
        	<ImageLoaded condition="end with">\Windows\System32\bcryptprimitives.dll</ImageLoaded>
			<ImageLoaded condition="end with">\QtWebEngineProcess.exe</ImageLoaded>
			<ImageLoaded condition="contains">\Windows\Veeam\Backup</ImageLoaded>
			<ImageLoaded condition="contains">\Windows\VeeamLogShipper</ImageLoaded>
			<ImageLoaded condition="contains">\VMware\</ImageLoaded>
			<ImageLoaded condition="contains">\VMware\Vmware Tools</ImageLoaded>
			<Image condition="image">MsMpEng.exe</Image>
			<Image condition="image">pythonw.exe</Image>
			<Image condition="image">provtool.exe</Image>
			<Image condition="image">sdiagnhost.exe</Image>
			<Image condition="image">OneDriveStandaloneUpdater.exe</Image>
			<Image condition="image">Teams.exe</Image>
			<Image condition="image">backgroundTaskHost.exe</Image>
			<Image condition="image">DismHost.exe</Image>
			<Image condition="end with">\Microsoft\Teams\Update.exe</Image>
		</ImageLoad>
    </RuleGroup>    
<!-- Event ID 7 == Image Loaded -->
	<RuleGroup name="" groupRelation="or">
      <ImageLoad onmatch="include">
	  <!--- Suspicious action rules-->
		<Rule name="technique_id=T1003,technique_name=OS Credential Dumping - Credential Access - Mimikatz Cred Dumping" groupRelation="and"> <!-- OS Credential Dumping Mimikatz Cred Dumping RISK 100 -->
			<Image condition="image">rundll32.exe</Image>
			<ImageLoaded condition="contains all">vaultcli.dll;wlanapi.dll</ImageLoaded>
			<ImageLoaded condition="excludes">combase.dll</ImageLoaded>
			<ImageLoaded condition="excludes">cryptdll.dll</ImageLoaded>
			<ImageLoaded condition="excludes">imm32.dll</ImageLoaded>
			<ImageLoaded condition="excludes">logoncli.dll</ImageLoaded>
			<ImageLoaded condition="excludes">netapi32.dll</ImageLoaded>
			<ImageLoaded condition="excludes">ntasn1.dll</ImageLoaded>
			<ImageLoaded condition="excludes">ntdsapi.dll</ImageLoaded>
			<ImageLoaded condition="excludes">samlib.dll</ImageLoaded>
			<ImageLoaded condition="excludes">shcore.dll</ImageLoaded>
			<ImageLoaded condition="excludes">srvcli.dll</ImageLoaded>
		</Rule>
        <Rule name="technique_id=T1047,technique_name=Windows Management Instrumentation - Office wmi load" groupRelation="and"> <!-- Credit to @Antonlovesdnb https://blog.pwntario.com/team-posts/antons-posts/hunting-malicious-macros-->
          <Image  condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <ImageLoaded condition="is">C:\Windows\SysWOW64\wbem\wbemdisp.dll</ImageLoaded>
        </Rule>		
		<Rule name="technique_id=T1218.005,technique_name=MSHTA with AMSI Bypass" groupRelation="and"> <!--Detect execution of HTA using the IE Javascript engine to bypass AMSI-->
          <OriginalFileName condition="is">jscript.dll</OriginalFileName>
          <Image condition="end with">mshta.exe</Image>
        </Rule>
        <Rule name="technique_id=T1218.005,technique_name=MSHTA with AMSI Bypass" groupRelation="and"> <!--Detect execution of HTA using the IE Javascript engine to bypass AMSI-->
          <OriginalFileName  condition="is">jscript9.dll</OriginalFileName>
          <Image condition="end with">mshta.exe</Image>
        </Rule>		
		<Rule name="technique_id=T1037.005,technique_name=Boot or Logon Initialization Scripts - Startup Items - bginfo" groupRelation="and"> <!--bginfo abuse-->
          <Image condition="end with">bginfo.exe</Image>
          <ImageLoaded condition="contains any">System.ni.dll;System.Core.ni.dll</ImageLoaded>
        </Rule>
	<!---dotnet_load-->
		<Rule name="technique_id=T1055,technique_name=Process Injection - clr" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName condition="is">clr.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>
          <Rule name="technique_id=T1055,technique_name=Process Injection - clrjit" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName condition="is">clrjit.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>
          <Rule name="technique_id=T1055,technique_name=Process Injection - mscoreei" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName  condition="is">mscoreei.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>
          <Rule name="technique_id=T1055,technique_name=Process Injection - mscoree" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName condition="is">mscoree.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>
          <Rule name="technique_id=T1055,technique_name=Process Injection - mscoreeis" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName condition="is">mscoreeis.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>
          <Rule name="technique_id=T1055,technique_name=Process Injection - mscorlib" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName condition="is">mscorlib.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>
          <Rule name="technique_id=T1055,technique_name=Process Injection - mscorlib.ni" groupRelation="and"> <!-- Credit https://redhead0ntherun.medium.com/detecting-net-c-injection-execute-assembly-1894dbb04ff7-->
            <OriginalFileName condition="is">mscorlib.ni.dll</OriginalFileName>
            <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
          </Rule>		
	<!---Living off the land-->
		<ImageLoaded name="technique_id=T1047,technique_name=Windows Scheduled Tasks" condition="end with">mstask.dll</ImageLoaded>	
	<!---GrimResource MMC Attacks-->
		<Rule name="technique_id=T1218.014,technique_name=System Binary Proxy Execution - GrimResource MMC attack" groupRelation="and"> <!--https://www.elastic.co/security-labs/grimresource-->
          <Image condition="end with">mmc.exe</Image>
          <ImageLoaded condition="contains any">wshom.ocx;jscript.dll;vbscript.dll;msxml3.dll;apds.dll</ImageLoaded>
        </Rule>		
	<!---Other-->
		 <Rule name="technique_id=T1047,technique_name=Windows Management Instrumentation - wmiutils" groupRelation="and"> <!---Suspicious location-->
			<ImageLoaded condition="end with">wmiutils.dll</ImageLoaded>
            <Image condition="excludes any">WmiPrvSE.exe;winlogbeat.exe</Image>
        </Rule>
		<ImageLoaded name="technique_id=T1059,technique_name=Command and Scripting Interpreter" condition="end with">wshom.ocx</ImageLoaded>  <!---Thanks to Carlos Perez-->
		<ImageLoaded name="technique_id=T1210,technique_name=Exploitation of Remote Services" condition="begin with">C:\Windows\System32\spool\drivers\</ImageLoaded> <!--In order to detect PrintNightmare on servers-->
		<ImageLoaded name="technique_id=T1197,technique_name=BITS" condition="end with">bitsproxy.dll</ImageLoaded> <!---Bitsproxy-->
	<!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">system.management.automation.ni.dll</ImageLoaded> <!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">system.management.automation.dll</ImageLoaded> <!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Commands.Diagnostics.dll</ImageLoaded> <!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Commands.Management.dll</ImageLoaded> <!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Commands.Utility.dll</ImageLoaded> <!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.ConsoleHost.dll</ImageLoaded> <!---Powershell-->
		<ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Security.dll</ImageLoaded> <!---Powershell-->
	<!---Suspicious locations-->	
	    <Rule name="technique_id=T1073,technique_name=DLL Side-Loading - programdata" groupRelation="and"> <!---Suspicious location-->
			<ImageLoaded condition="begin with">c:\programdata\</ImageLoaded>
            <ImageLoaded condition="excludes any">\Windows Defender\Platform\;\Razer\Synapse3\</ImageLoaded>
        </Rule>
	    <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Windows Media" condition="begin with">C:\Windows\Media\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Windows addins" condition="begin with">C:\Windows\addins\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - systemprofile" condition="begin with">C:\Windows\system32\config\systemprofile\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Debug" condition="begin with">C:\Windows\Debug\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Temp" condition="begin with">C:\Windows\Temp</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - PerfLogs" condition="begin with">C:\PerfLogs\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Help" condition="begin with">C:\Windows\Help\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Logs" condition="begin with">C:\Intel\Logs\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - C Temp" condition="begin with">C:\Temp</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - repair" condition="begin with">C:\Windows\repair\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - security" condition="begin with">C:\Windows\security\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Fonts" condition="begin with">C:\Windows\Fonts\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - file" condition="begin with">file:</ImageLoaded> <!---Suspicious location-->
		<ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading - Downloads" condition="contains all">\Users\;\Downloads</ImageLoaded> <!---Suspicious location-->
		<ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading - Public" condition="contains all">\Users\;\Public</ImageLoaded> <!---Suspicious location-->
		<ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading - Documents" condition="contains all">\Users\;\Documents</ImageLoaded> <!---Suspicious location-->
		<ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading - Music" condition="contains all">\Users\;\Music</ImageLoaded> <!---Suspicious location-->
		<ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading - Video" condition="contains all">\Users\;Video</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - Recycle bin" condition="contains">$Recycle.bin\</ImageLoaded> <!---Suspicious location-->
        <ImageLoaded name="technique_id=T1073,technique_name=DLL Side-Loading - IME" condition="contains">\Windows\IME\</ImageLoaded> <!---Suspicious location-->        
      </ImageLoad>
    </RuleGroup>    
<!-- Event ID 8 == CreateRemoteThread. -->
	<!--COMMENT: Monitor for processes injecting code into other processes. Often used by malware to cloak their actions. Exclude mostly-safe sources and log anything else -->
	<!--COMMENT: If using modern AV on endpoint then you are protected. If you have uninstalled AV's from servers you need to monitor all -->
	<!--COMMENT:This event is only usable for Memory forensics -->
	<!-- CreateRemoteThread - Include -->
	<RuleGroup name="" groupRelation="or">
	<CreateRemoteThread onmatch="include">
		<SourceImage name="technique_id=T1055,technique_name=Process Injection" condition="begin with">C:\</SourceImage>
		<SourceImage name="technique_id=T1055,technique_name=Process Injection" condition="begin with">\\</SourceImage>
		</CreateRemoteThread>	
		</RuleGroup>
	<!-- CreateRemoteThread - Exclude -->
	<RuleGroup name="" groupRelation="or">	
	<CreateRemoteThread onmatch="exclude">	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\csrss.exe</SourceImage>
		<TargetImage condition="is">C:\WINDOWS\System32\svchost.exe</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\wbem\WmiPrvSE.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\rundll32.exe</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\csrss.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\system32\svchost.exe</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\Sysmon64.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\svchost.exe</TargetImage>
	</Rule>
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\services.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\svchost.exe</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\WerFault.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\svchost.exe</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\csrss.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\rundll32.exe</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\svchost.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\rundll32.exe</TargetImage>
	</Rule>
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\rundll32.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\explorer.exe</TargetImage>
	</Rule>
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\rundll32.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\explorer.exe</TargetImage>
	</Rule>
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\csrss.exe</SourceImage>
		<TargetImage condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Platform</TargetImage>
	</Rule>	
	<Rule groupRelation="and">	
		<SourceImage condition="is">C:\Windows\System32\winlogon.exe</SourceImage>
		<TargetImage condition="is">C:\Windows\System32\csrss</TargetImage>
	</Rule>
	<SourceImage condition="is">C:\Windows\System32\wbem\WmiPrvSE.exe</SourceImage>
	 </CreateRemoteThread>
	</RuleGroup>	
<!-- Event ID 9 == RawAccessRead -->
		<!-- COMMENT Monitor for raw sector-level access to the disk, often used to bypass access control lists or access locked files. -->
		<!-- COMMENT Disabled by default since including even one entry here activates this component. Reward/performance/rule maintenance decision. -->
		<!-- COMMENT You will likely want to set this to a full capture on domain controllers, where no process should be doing raw reads. -->
		<!-- COMMENT The below rules have been done on a Windows 10 / 11 systems and schould remove most common legit actions-->
		<!-- COMMENT Be carefull on vmware systems running guests, some monitoring of RawAccessRead can frezze up systems - Test before use - Schould be addresed by this config and don't frezze. -->		
	<RuleGroup name="RawAccess Read" groupRelation="or">
     <RawAccessRead onmatch="exclude">	 
	<Rule groupRelation="and">	
		<Image condition="is">System</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	 
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\svchost.exe</Image>
		<Device condition="contains">\Device\</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\WINDOWS\TaskhostView.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>		
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\taskhostw.exe</Image>
		<Device condition="contains">\Device\</Device>		
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="end with">\ShellExperienceHost.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>		
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\wininit.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>		
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\SearchIndexer.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>		
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\explorer.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>		
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\lsass.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
		<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\wbem\WmiPrvSE.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\NETWORK SERVICE</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Platform\</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">MsMpEng.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\smss.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\LogonUI.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Program Files\Dell\DTP\InstrumentationSubAgent\Dell.TechHub.Instrumentation.SubAgent.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-authd.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
		<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\SrTasks.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\wuauclt.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\backgroundTaskHost.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="begin with">C:\Windows\SystemApps\Microsoft.Windows.Search</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\MoUsoCoreWorker.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="begin with">C:\Windows\SystemApps\MicrosoftWindows.Client.CBS</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="begin with">C:\Windows\WinSxS\</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\autochk.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\MoUsoCoreWorker.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\UUS\amd64\MoUsoCoreWorker.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\dllhost.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\RuntimeBroker.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="begin with">C:\Windows\SystemApps\Microsoft.Windows</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\smartscreen.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\DeviceCensus.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\DriverStore\FileRepository\iastorvd.inf_amd64_346bd04e375689ec\RstMwService.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\ntoskrnl.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\CompatTelRunner.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Program Files\CUAssistant\culauncher.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="end with">\plugins\avserver\avserver.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\DiskSnapshot.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Program Files\ruxim\RUXIMICS.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\WaaSMedicAgent.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="end with">\HostMetadata\NVMEHostmetadata.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="end with">C:\Windows\System32\spoolsv.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="end with">C:\Windows\System32\poqexec.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="end with">C:\Program Files\VeraCrypt\VeraCrypt.exe</Image>
		<Device condition="contains">\Device\VeraCryptVolumeX</Device>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="end with">C:\Windows\ImmersiveControlPanel\SystemSettings.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="end with">\MpSigStub.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="begin with">C:\Windows\System32\DriverStore\FileRepository\</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="end with">\NirSoft\x64\fileactivitywatch.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\WinSAT.exe</Image>
		<Device condition="contains">\Device\</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">Registry</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="end with">\RstMwService.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="end with">\DiagnosticsSubAgent\Disk.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\winlogon.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\MRT.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\UUS\amd64\wuaucltcore.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>	
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\VSSVC.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\rundll32.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
		<User condition="is">NT AUTHORITY\SYSTEM</User>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\SecurityHealthService.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>
	<Rule groupRelation="and">	
		<Image condition="is">C:\Windows\System32\msconfig.exe</Image>
		<Device condition="contains">\Device\Harddisk</Device>
	</Rule>	
	</RawAccessRead>	 
	</RuleGroup>	
<!-- Event ID 10 == ProcessAccess Exclude -->
    <RuleGroup name="" groupRelation="or">
      <ProcessAccess onmatch="exclude">
	    <Rule groupRelation="and">
          <SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage> <!--Exclude Teams-->
          <TargetImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</TargetImage> <!--Exclude Teams-->
        </Rule>		
		<Rule groupRelation="and">
          <SourceImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</SourceImage> <!--Exclude Visual Studio Code-->
          <TargetImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</TargetImage> <!--Exclude Visual Studio Code-->
          <GrantedAccess condition="is">0x100000</GrantedAccess> <!--SYNCHRONIZE access to its children -->
        </Rule>
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</SourceImage> <!--Exclude Visual Studio Code-->
          <TargetImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</TargetImage> <!--Exclude Visual Studio Code-->
          <GrantedAccess condition="is">0x1401</GrantedAccess> <!--PROCESS_QUERY_LIMITED_INFORMATION,PROCESS_QUERY_INFORMATION and PROCESS_TERMINATE access to its children-->
        </Rule>
        <Rule groupRelation="and">
          <SourceImage condition="contains all">C:\Users\;\AppData\Local\Programs\Microsoft VS Code\Code.exe</SourceImage> <!--Exclude Visual Studio Code-->
          <TargetImage condition="contains all">C:\Users\;\AppData\Local\Programs\Microsoft VS Code\Code.exe</TargetImage> <!--Exclude Visual Studio Code-->
          <GrantedAccess condition="is">0x1401</GrantedAccess> <!--PROCESS_QUERY_LIMITED_INFORMATION,PROCESS_QUERY_INFORMATION and PROCESS_TERMINATE access to its children-->
        </Rule>
	    <Rule groupRelation="and">
          <SourceImage condition="is">C:\WINDOWS\Explorer.EXE</SourceImage> <!--Exclude Windows Explorer-->
          <TargetImage condition="is">C:\Windows\System32\SecurityHealthSystray.exe</TargetImage> <!--Exclude MS Windows Safety alert-->
        </Rule>		
		<Rule groupRelation="and">
          <SourceImage condition="is">C:\WINDOWS\system32\taskhostw.exe</SourceImage> <!--Exclude Windows tash host-->
          <TargetImage condition="end with">NGenTask.exe</TargetImage> <!--Exclude MS Windows Safety alert-->
        </Rule>		
		<SourceImage condition="end with">wmiprvse.exe</SourceImage>
		<SourceImage condition="end with">GoogleUpdate.exe</SourceImage> <!--Exclude Google update-->
		<SourceImage condition="end with">LTSVC.exe</SourceImage>
		<SourceImage condition="end with">taskmgr.exe</SourceImage> <!--Exclude taskmanager-->
		<SourceImage condition="end with">VBoxService.exe</SourceImage>	<!-- Exclude Virtual Box -->
		<SourceImage condition="end with">vmtoolsd.exe</SourceImage> <!-- Exclude VMWare -->
		<SourceImage condition="is">C:\Program Files\Dell\SupportAssistAgent\bin\SupportAssistAgent.exe</SourceImage> <!-- Exclude Dell Support Assist Agent -->
		<SourceImage condition="is">C:\Program Files\Dell\DTP\DiagnosticsSubAgent\Dell.TechHub.Diagnostics.SubAgent.exe</SourceImage> <!-- Exclude Dell Support Assist Agent -->		
		<SourceImage condition="is">C:\Program Files\Dell\TechHub\Dell.TechHub.exe</SourceImage> <!-- Exclude Dell Support Assist Agent -->
		<SourceImage condition="is">C:\Program Files\Dell\DTP\DataManagerSubAgent\Dell.TechHub.DataManager.SubAgent.exe</SourceImage> <!-- Exclude Dell Support Assist Agent -->
		<SourceImage condition="is">C:\Program Files\Dell\DellDataVault\DDVDataCollector.exe</SourceImage> <!-- Exclude Dell Support Assist Agent -->		
		<SourceImage condition="end with">NGenTask.exe</SourceImage> <!-- Exclude Microsoft.NET\Framework64 from temp -->
		<SourceImage condition="is">C:\Program Files\Mozilla Firefox\firefox.exe</SourceImage> <!-- Exclude Firefox -->
		<SourceImage condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-authd.exe</SourceImage> <!-- Exclude VMWare Workstation -->
		<SourceImage condition="end with">\Citrix\System32\wfshell.exe</SourceImage> <!--Citrix process in C:\Program Files (x86)\Citrix\System32\wfshell.exe -->
		<SourceImage condition="is">C:\Windows\System32\lsm.exe</SourceImage> <!-- System process under C:\Windows\System32\lsm.exe -->
		<SourceImage condition="is">C:\WINDOWS\CCM\CcmExec.exe</SourceImage> <!-- Exclude SCCM -->
		<SourceImage condition="end with">Microsoft.Identity.AadConnect.Health.AadSync.Host.exe</SourceImage> <!-- Microsoft Azure AD Connect Health Sync Agent -->
		<SourceImage condition="is">C:\Program Files\AMD\CNext\CNext\Radeonsoftware.exe</SourceImage> <!-- AMD Radeon software -->
		<SourceImage condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Platform</SourceImage> <!--Exclude Windows Defender-->
		<SourceImage condition="is">C:\Program Files\Splunk\bin\splunkd.exe</SourceImage> <!--Exclude Splunk-->
		<SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\StandaloneUpdater\OneDriveSetup.exe</SourceImage> <!--Exclude OneDrive-->
		<TargetImage condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-tray.exe</TargetImage> <!--Exclude Vmware Workstation tray-->
		<GrantedAccess>0x1000</GrantedAccess> <!-- PROCESS_QUERY_LIMITED_INFORMATION Generic call, quite noisy and tells not much-->
		<GrantedAccess>0x1400</GrantedAccess> <!-- PROCESS_QUERY_LIMITED_INFORMATION + PROCESS_QUERY_INFORMATION Generic call, quite noisy and tells nothing-->
		<GrantedAccess>0x101400</GrantedAccess> 	<!-- PROCESS_QUERY_LIMITED_INFORMATION + PROCESS_QUERY_INFORMATION + SYNCHRONIZE Generic call, quite noisy and tells nothing-->
		<GrantedAccess>0x101000</GrantedAccess>	<!-- PROCESS_QUERY_LIMITED_INFORMATION + SYNCHRONIZE Generic call, quite noisy and tells nothing-->
      </ProcessAccess>
    </RuleGroup>
<!-- Event ID 10 == ProcessAccess Include -->
	<RuleGroup name="" groupRelation="or">
      <ProcessAccess onmatch="include">
	 <!--Process in memory--> 
		<Rule name="Processes accessing other process in memory - svchost.exe" groupRelation="and"> <!--Monitor for processes accessing other process' memory.-->
			<TargetImage condition="is">C:\Windows\System32\svchost.exe</TargetImage>
			<GrantedAccess>0x1F3FFF</GrantedAccess>
		</Rule>		
		<Rule name="Processes accessing other process in memory - verclsid.exe" groupRelation="and"> <!--Monitor for processes accessing other process' memory.-->
			<TargetImage condition="is">C:\Windows\System32\verclsid.exe</TargetImage>
			<GrantedAccess>0x1F3FFF</GrantedAccess>
        </Rule>
	<!--Direct system calls - UNKNOWN-->		
		<Rule name="technique_id=T1055,technique_name=Process Injection - Direct system calls - UNKNOWN" groupRelation="and"> <!-- https://medium.com/falconforce/falconfriday-direct-system-calls-and-cobalt-strike-bofs-0xff14-741fa8e1bdd6 -->
			<CallTrace condition="contains">UNKNOWN(</CallTrace>
			<CallTrace condition="excludes any">C:\Windows\SYSTEM32\ntdll.dll;C:\Windows\SYSTEM32\win32u.dll;C:\Windows\SYSTEM32\wow64win.dll;kernelbase.dll;wow64.dll;kernel32.dll;lsasrv.dll;themeservice.dll;wow64win.dll</CallTrace>
		</Rule>			
	<!--Known LOLBAS ProcessAccess-->
        <TargetImage name="technique_id=T1105,technique_name=LOLBAS Ingress Tool Transfer - AppInstaller" condition="end with">\AppInstaller.exe</TargetImage> <!-- REF: https://lolbas-project.github.io/lolbas/Binaries/AppInstaller/ -->
	<!--Process Hollowing-->
		<GrantedAccess name="technique_id=T1055.012,technique_name=Process Hollowing - Used by Mimikatz">0x21410</GrantedAccess><!-- misc::detours in Mimikatz, thanks @Carlos_Perez -->
		<GrantedAccess name="technique_id=T1055.012,technique_name=Process Hollowing - Granted Access 0x0800">0x0800</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME -->
		<GrantedAccess name="technique_id=T1055.012,technique_name=Process Hollowing - Granted Access 0x800">0x800</GrantedAccess>  <!-- PROCESS_SUSPEND_RESUME -->		
	<!--Process Hollowing-->	    
        <GrantedAccess name="technique_id=T1003,technique_name=Credential Dumping - Granted Access 0x0810 - Possible memory dump">0x0810</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_READ - possible memory dump to extract sensitive information -->
		<GrantedAccess name="technique_id=T1003,technique_name=Credential Dumping - Granted Access 0x810 - Possible memory dump">0x810</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_READ - possible memory dump to extract sensitive information -->
	<!--Process Injection-->
        <GrantedAccess name="technique_id=T1055,technique_name=Process Injection - Granted Access 0x0820 - Possible memory injection ">0x0820</GrantedAccess> <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_WRITE - possible memory injection -->
		<GrantedAccess name="technique_id=T1055,technique_name=Process Injection - Granted Access 0x820 - Possible memory injection">0x820</GrantedAccess>  <!-- PROCESS_SUSPEND_RESUME + PROCESS_VM_WRITE - possible memory injection -->
		<Rule groupRelation="and" name="technique_id=T1055,technique_name=Process Injection - Possible malicious macros"> <!-- Credit to @Antonlovesdnb https://blog.pwntario.com/team-posts/antons-posts/hunting-malicious-macros-->
			<SourceImage condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
			<CallTrace condition="contains">\Microsoft Shared\VBA</CallTrace>
        </Rule>	
    <!--Process Masquerading-->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Perflogs" condition="begin with">C:\PerfLogs\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - $Recycle.bin" condition="begin with">C:\$Recycle.bin\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Logs" condition="begin with">C:\Intel\Logs\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Default" condition="begin with">C:\Users\Default\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Public" condition="begin with">C:\Users\Public\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - NetworkService" condition="begin with">C:\Users\NetworkService\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Fonts" condition="begin with">C:\Windows\Fonts\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Debug" condition="begin with">C:\Windows\Debug\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Media" condition="begin with">C:\Windows\Media\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - Help" condition="begin with">C:\Windows\Help\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - addins" condition="begin with">C:\Windows\addins\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - repair" condition="begin with">C:\Windows\repair\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - security" condition="begin with">C:\Windows\security\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - systemprofile" condition="begin with">C:\Windows\system32\config\systemprofile\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - VolumeShadowCopy" condition="contains">VolumeShadowCopy</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - htdocs" condition="contains">\htdocs\</SourceImage> <!-- suspicious_locations -->
        <SourceImage name="technique_id=T1036,technique_name=Masquerading - wwwroot" condition="contains">\wwwroot\</SourceImage> <!-- suspicious_locations -->
		<Rule name="technique_id=T1036,technique_name=Masquerading - Temp" groupRelation="and"> <!-- Temp folder - can create noice -->
			<SourceImage condition="contains">\Temp\</SourceImage> 
			<SourceImage condition="excludes any">\MsMpEng.exe;\MpSigStub.exe;</SourceImage>
		</Rule>
	<!--Executing files from the Useres Desktop-->
        <Rule name="Process Access,Launch from Desktop" groupRelation="and"> <!--Executing files from the Useres Desktop-->
			<TargetImage condition="contains all">\Users\;\Desktop</TargetImage> 
		</Rule>		
      </ProcessAccess>
    </RuleGroup>
<!-- Event ID 11 == FileCreate. -->
	<!--FileCreate start from here-->
		<RuleGroup name="" groupRelation="or">
		<FileCreate onmatch="include">
	<!--OS Credential Dumping Rule group-->
          <Rule name="technique_id=T1003,technique_name=OS Credential Dumping - taskmgr lsass dump" groupRelation="and"> <!-- OS Credential Dumping Capture LSASS dump from task manager -->
			<Image condition="image">taskmgr.exe</Image>
			<TargetFilename condition="contains all">lsass;.dmp</TargetFilename>	
	     </Rule>
		 <Rule name="technique_id=T1003,technique_name=OS Credential Dumping - Extension name dmp" groupRelation="and"> <!-- OS Credential Dumping Capture LSASS dump from task manager --> 
			<TargetFilename condition="contains any">.dmp;PWDUMP</TargetFilename>
			<Image condition="excludes">WerFault.exe</Image>
		</Rule>	
	<!--APT-Detection-->
		<TargetFilename name="technique_id=G0034,technique_name=Kapeka" condition="contains">C:\Windows\secrets.txt</TargetFilename> <!-- Ref: https://www.withsecure.com/en/whats-new/pressroom/withsecure-uncovers-kapeka-a-new-malware-with-links-to-russian-nation-state-threat-group-sandworm -->
	<!--GrimResource MMC Attacks -->
		<Rule name="technique_id=T1218.014,technique_name=System Binary Proxy Execution - GrimResource MMC attack - redirect file created" groupRelation="and"> <!-- https://www.elastic.co/security-labs/grimresource -->
			<TargetFilename condition="contains">redirect</TargetFilename>
			<TargetFilename condition="contains any">\AppData\Local\Microsoft\Windows\INetCache\IE</TargetFilename>
		</Rule>	
	<!-- Sysmon folders -->	
		<TargetFilename name="technique_id=T1562.001,technique_name=Disable or Modify Tools - File writes to Sysmon Folder" condition="begin with">C:\Windows\Sysmon</TargetFilename>	<!-- Sysmon folder -->		
	<!--Application Shimming-->
        <TargetFilename name="technique_id=T1138,technique_name=Application Shimming" condition="contains">C:\Windows\AppPatch\Custom</TargetFilename>	
	<!--Windows PowerShell TranScription logging used for Windows event logging-->	
		<Rule name="technique_id=T1562.001,technique_name=Disable or Modify Tools - File writes to PS-Transcript Folder" groupRelation="and"> <!-- Files contains PowerShell logging transcripts -->
			<TargetFilename condition="contains">PowerShell_transcript.</TargetFilename>
			<TargetFilename condition="contains any">.txt</TargetFilename>
		</Rule>
    <!--Office Signed Binary Proxy Execution -->
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="contains">AppData\Local\Microsoft\CLR_v2.0\UsageLogs\</TargetFilename>
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\wscript.exe.log</TargetFilename>
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\wmic.exe.log</TargetFilename>
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\mshta.exe.log</TargetFilename> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Mshta/ -->
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\svchost.exe.log</TargetFilename>
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\regsvr32.exe.log</TargetFilename>
        <TargetFilename name="technique_id=1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\rundll32.exe.log</TargetFilename>		
	<!--Browser Extensions folders filewrite-->
		<TargetFilename name="technique_id=1176,technique_name=Browser Extensions - Write to Chrome Extension folder" condition="contains">\AppData\Local\Google\Chrome\User Data\Default\Extensions</TargetFilename> <!--Chrome Extension watch-->
		<TargetFilename name="technique_id=1176,technique_name=Browser Extensions - File Write to Edge Extension folder" condition="contains">\AppData\Local\Microsoft\Edge\User Data\Default\Extensions</TargetFilename> <!--Edge Extension watch-->
		<TargetFilename name="technique_id=1176,technique_name=Browser Extensions - File Write to Firefox Extension folder" condition="contains">.default-release\extensions</TargetFilename> <!--Firefox Extension watch-->
	<!--Possible password files in the clear -->		
		<Rule name="technique_id=T1552.001,technique_name=Unsecured Credentials - file contain password in name" groupRelation="and"> <!-- Files may contain passwords -->
			<TargetFilename condition="contains">password</TargetFilename>
			<TargetFilename condition="contains any">.xlsx;.docx;.odt;.txt;.doc;.csv;.rtf</TargetFilename>
			<TargetFilename condition="excludes any">\Local\Temp\;\PluginsStorage;\XrmToolBox\Backup;chrome_PuffinComponentUnpacker;\ZxcvbnData\</TargetFilename>
			<Image condition="excludes any">msedgewebview2.exe;msedge.exe;MoUsoCoreWorker.exe</Image>
		</Rule>
		<Rule name="technique_id=T1552.001,technique_name=Unsecured Credentials - Keepass export to Clear formats" groupRelation="and"> <!-- Files may contain passwords -->
			<Image condition="contains">\KeePass.exe</Image>
			<TargetFilename condition="contains any">.csv;.xml;.html;.xsl</TargetFilename>
		</Rule>
	<!--Local Data Staging -->		
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Program" condition="contains">C:\Program\</TargetFilename>
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Temp" condition="contains">C:\Temp\</TargetFilename> <!-- NOT a default Windows temp folder -->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - PerfLogs" condition="contains">C:\PerfLogs\</TargetFilename>
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Public" condition="contains">C:\Users\Public\</TargetFilename>
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - AppData Temp" condition="contains">\AppData\Temp\</TargetFilename>
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Driver Folder" condition="contains">C:\Windows\SysWOW64\Drivers</TargetFilename>
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Spool driver" condition="contains">C:\Windows\System32\spool\drivers</TargetFilename>
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Default folder" condition="contains">C:\Users\Default</TargetFilename>
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - OneDriver Folder" condition="contains">%HOMEPATH%\OneDrive\</TargetFilename> <!--OneDrive Folder for monitor-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - File in GroupPolicy Scripts folder created" condition="contains">C:\Windows\System32\GroupPolicy\Machine\Scripts</TargetFilename> <!--File in machine Scripts folder created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - File in user Scripts folder created" condition="contains">C:\Windows\System32\GroupPolicy\User\Scripts</TargetFilename> <!--File in user Scripts folder created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Mshta" condition="end with">.hta</TargetFilename> <!--HTML Application created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - ClickOnce Deployment Manifest File created" condition="end with">.application</TargetFilename> <!--ClickOnce Deployment Manifest File created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Microsoft Application Reference File File created" condition="end with">.appref-ms</TargetFilename> <!--Microsoft Application Reference File created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Files created in Download folder " condition="contains">\Downloads</TargetFilename> <!--Downloaded files. Does not include "Run" files in IE-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Python GUI Source File created" condition="end with">.pyw</TargetFilename> <!--Python GUI Source File created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - EXE file created" condition="end with">.exe</TargetFilename> <!--Windows exe file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows BAT file" condition="end with">.bat</TargetFilename> <!--Windows bat file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows CMD file" condition="end with">.cmd</TargetFilename> <!--Windows CMD file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Pyton file created" condition="end with">.py</TargetFilename> <!--Python Script file created-->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Python Compiled File" condition="end with">.pyc</TargetFilename> <!--Python Compiled file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Remote Desktop files" condition="end with">.rdp</TargetFilename> <!--Microsoft Windows Remote Desktop files-->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Outlook content file Created" condition="contains">\Content.Outlook\</TargetFilename> <!--Outlook content file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows rtf file created" condition="end with">.rft</TargetFilename> <!--Windows rtf file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Jakarta Server Page Created" condition="end with">.jsp</TargetFilename> <!--Jakarta Server Page file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - XML Jakarta Server Page Created" condition="end with">.jspx</TargetFilename> <!--XML Jakarta Server Page file created-->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Active Server Page file Created" condition="end with">.asp</TargetFilename> <!--Active Server Page Extended file created-->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Active Server Page Extended File Created" condition="end with">.aspx</TargetFilename> <!--Active Server Page Extended file created-->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - PHP file created" condition="end with">.php</TargetFilename> <!--Java Web Archive file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Java Web Archive file Created" condition="end with">.war</TargetFilename> <!--Java Web Archive file created-->
        <TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - WinAce Compressed File Created" condition="end with">.ace</TargetFilename> <!--WinAce Compressed file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Internet Query file Created" condition="end with">.iqy</TargetFilename> <!--Windows iqy file created-->
		<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Microsoft Word Add-in File Created" condition="end with">.wll</TargetFilename> <!--Microsoft Word Add-in file created-->
		<Rule name="technique_id=T1074.001,technique_name=Local Data Staging - Windows system driver file" groupRelation="and"> <!-- Windows system driver file -->
			<TargetFilename condition="end with">.sys</TargetFilename>
			<TargetFilename condition="excludes any">C:\swapfile.sys;C:\pagefile.sys</TargetFilename>
			<Image condition="excludes any">\smss.exe;\MsMpEng.exe;\soffice.bin</Image>
		</Rule>
		<Rule name="technique_id=T1074.001,technique_name=Local Data Staging - Windows temp" groupRelation="and"> <!-- Windows default temp folder - can create noice -->
			<TargetFilename condition="contains">C:\Windows\Temp\</TargetFilename> 
			<Image condition="excludes any">\MsMpEng.exe;\svchost.exe;\MpSigStub.exe;\MpCmdRun.exe;\SecurityHealthService.exe;\wmiprvse.exe;\javaw.exe</Image>
		</Rule>		
		<Rule name="technique_id=T1074.001,technique_name=Local Data Staging - Favorites" groupRelation="and"> <!-- Windows Users Favorites folder -->
			<TargetFilename condition="contains">\Favorites</TargetFilename> 
			<Image condition="excludes">.url</Image>
		</Rule>
		<Rule name="technique_id=T1072,technique_name=Software Deployment Tools - CrowdStrike Falcon EDR" groupRelation="and"> <!-- CrowdStrike Falcon EDR driver updates -->
			<TargetFilename condition="contains">\System32\drivers\CrowdStrike</TargetFilename> 
			<Image condition="excludes">.sys</Image>
		</Rule>		
	<!--PowerShell file writes -->
        <TargetFilename name="technique_id=T1086,technique_name=PowerShell" condition="begin with">C:\Windows\System32\WindowsPowerShell</TargetFilename>
        <TargetFilename name="technique_id=T1086,technique_name=PowerShell" condition="begin with">C:\Windows\SysWOW64\WindowsPowerShell</TargetFilename>
		<TargetFilename name="technique_id=T1086,technique_name=PowerShell" condition="end with">.ps1</TargetFilename> <!--PowerShell Script file created-->
        <TargetFilename name="technique_id=T1086,technique_name=PowerShell" condition="end with">.ps2</TargetFilename> <!--PowerShell Script file created-->
	<!--Known file writes -->
		<TargetFilename name="technique_id=T1020,technique_name=rclone" condition="contains">\rclone\</TargetFilename> 
		<TargetFilename name="technique_id=T1064,technique_name=Scripting - chm file" condition="end with">.chm</TargetFilename> <!--Compiled HTML Help file created-->
        <TargetFilename name="technique_id=T1566,technique_name=DS0022 - Disc IMG data file created" condition="end with">.img</TargetFilename> <!--Disc Image Data File created-->
		<TargetFilename name="technique_id=T1127,technique_name=Trusted Developer Utilities - proj file" condition="end with">.*proj</TargetFilename> <!--Visual Studio Project File File created-->
        <TargetFilename name="technique_id=T1127,technique_name=Trusted Developer Utilities - sln file" condition="end with">.sln</TargetFilename> <!--Visual Studio Solution File created-->
		<TargetFilename name="technique_id=T1187,technique_name=Forced Authentication - lnk file" condition="end with">.lnk</TargetFilename> <!--Windows Shortcut File created-->
        <TargetFilename name="technique_id=T1187,technique_name=Forced Authentication - scf file" condition="end with">.scf</TargetFilename> <!--Windows Explorer Command-->
		<TargetFilename name="technique_id=S0002,technique_name=Mimikatz - kirbi file" condition="end with">.kirbi</TargetFilename> <!--Mimikatz or kekeo default kerberos ticket file extention-->
		<TargetFilename name="technique_id=T1566,technique_name=DS0022 - Windows ISO file created" condition="end with">.iso</TargetFilename> <!--Windows ISO file created-->
		<TargetFilename name="technique_id=T1566,technique_name=DS0022 - Windows MSC file created" condition="end with">.msc</TargetFilename> <!--Microsoft Management Console Snap-in Control file created-->
        <TargetFilename name="technique_id=T1566,technique_name=DS0022 - Windows Symbolic Link file created" condition="end with">.slk</TargetFilename> <!--Windows Symbolic Link file created-->
		<TargetFilename name="technique_id=T1566,technique_name=DS0022 - viratuel hard disk - vhd file" condition="end with">.vhd</TargetFilename> <!--Windows viratuel hard disk file created-->
		<TargetFilename name="technique_id=T1566,technique_name=DS0022 - html file created" condition="end with">.html</TargetFilename> <!--Hypertext Markup Language file created-->
	<!--Microsoft Office files created -->		
        <TargetFilename name="Windows Settings File File created" condition="end with">.settingcontent-ms</TargetFilename> <!--Windows Settings File created-->
        <TargetFilename name="Microsoft Word Macro-enabled Document Created" condition="end with">.docm</TargetFilename> <!--Microsoft Word Macro-enabled Document File created-->
        <TargetFilename name="Microsoft PowerPoint Macro-Enabled Presentation Created" condition="end with">.pptm</TargetFilename> <!--Microsoft PowerPoint Macro-Enabled Presentation File created-->
        <TargetFilename name="Microsoft Excel Macro-Enabled Spreadsheet Created" condition="end with">.xlsm</TargetFilename> <!--Microsoft Excel Macro-Enabled Spreadsheet File created-->
        <TargetFilename name="Microsoft Excel Macro Created" condition="end with">.xlm</TargetFilename> <!--Microsoft Excel Macro File created-->
        <TargetFilename name="Microsoft Word Macro-Enabled Document Template Created" condition="end with">.dotm</TargetFilename> <!--Microsoft Word Macro-Enabled Document Template File created-->
        <TargetFilename name="Microsoft Excel Macro-Enabled Spreadsheet Template Created" condition="end with">.xltm</TargetFilename> <!--Microsoft Excel Macro-Enabled Spreadsheet Template File created-->
        <TargetFilename name="Microsoft PowerPoint Macro-Enabled Template Created" condition="end with">.potm</TargetFilename> <!--Microsoft PowerPoint Macro-Enabled Template File created-->
        <TargetFilename name="Microsoft PowerPoint Macro-Enabled Show Created" condition="end with">.ppsm</TargetFilename> <!--Microsoft PowerPoint Macro-Enabled Show File created-->
        <TargetFilename name="Microsoft Office PowerPoint 2007+ Slide Macro Enabled Created" condition="end with">.sldm</TargetFilename> <!--Microsoft Office PowerPoint 2007+ Slide Macro Enabled File created-->
        <TargetFilename name="Microsoft Excel Macro-Enabled Add-In Created" condition="end with">.xlam</TargetFilename> <!--Microsoft Excel Macro-Enabled Add-In File created-->
        <TargetFilename name="Microsoft Excel Add-In File Created" condition="end with">.xla</TargetFilename> <!--Microsoft Excel Add-In File created-->
		<TargetFilename name="Microsoft Onenote File Created" condition="end with">.one</TargetFilename> <!--Microsoft Onenote File created-->
	<!--Windows common startup locations -->
        <TargetFilename name="technique_id=T1547,technique_name=Windows Menu Startup Folder" condition="contains">\Start Menu</TargetFilename> <!--Windows start menu-->
        <TargetFilename name="technique_id=T1547,technique_name=Windows Startup Folder" condition="contains">\Programs\Startup\</TargetFilename> <!--Windows startup Folder-->		
	<!--Remote Access Software -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Teamviewer" condition="image">teamviewer.exe</Image> <!-- Teamviewer Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Anydesk" condition="image">anydesk.exe</Image> <!-- Anydesk Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - AeroAdmin" condition="image">AeroAdmin.exe</Image> <!-- AeroAdmin Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - AnyViewer" condition="image">RCClient.exe</Image> <!-- AnyViewer Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - DsktopNow" condition="image">dsktopnow.exe</Image> <!-- DsktopNow Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - IperiusRemote" condition="image">IperiusRemote.exe</Image> <!-- IperiusRemote Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - Distant-desktop" condition="is">C:\ProgramData\Distant Desktop\dd.exe</Image> <!-- Distant-desktop Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - GetScreen" condition="is">C:\Program Files\Getscreen.me\getscreen.exe</Image> <!-- GetScreen Remote management tool -->
		<Image name="technique_id=T1219,technique_name=Remote Access Software - ShowMyPC3620" condition="end with">\-ShowMyPC3620\tvnserver.exe</Image> <!-- ShowMyPC3620 Remote management tool -->
	<!--GPO Bypass -->
		<TargetFilename name="WindowsGPOBypass" condition="begin with">%USERPROFILE%\ntuser.man</TargetFilename> <!-- Possible Windows GPO Bypass -->		
	<!--Traffic captures Eaves Dropping-->
		<TargetFilename name="technique_id=T1040,technique_name=Network Sniffing - EavesDropping - cap" condition="end with">.cap</TargetFilename> <!--Wireshark extension cap-->
		<TargetFilename name="technique_id=T1040,technique_name=Network Sniffing - EavesDropping - pcap" condition="end with">.pcap</TargetFilename> <!--Wireshark extension pcap-->
		<TargetFilename name="technique_id=T1040,technique_name=Network Sniffing - EavesDropping - pcapng" condition="end with">.pcapng</TargetFilename> <!--Wireshark extension pcapng-->
		<TargetFilename name="technique_id=T1040,technique_name=Network Sniffing - EavesDropping - erf" condition="end with">.erf</TargetFilename> <!--Endace extension erf-->
		<TargetFilename name="technique_id=T1040,technique_name=Network Sniffing - EavesDropping - etl" condition="end with">\Temp\NetTraces\NetTrace.etl</TargetFilename> <!--Windows packet capture file-->
	<!--Windows VM - AntiForensic -->
		<TargetFilename name="WindowsSandbox,technique_name=AntiForensic" condition="end with">.wsb</TargetFilename> <!--Windows Sandbox config file-->
	<!--Windows common startup locations -->
        <TargetFilename name="technique_id=T1547,technique_name=Windows Menu Startup Folder" condition="contains">\Start Menu</TargetFilename> <!--Windows start menu-->
        <TargetFilename name="technique_id=T1547,technique_name=Windows Startup Folder" condition="contains">\Programs\Startup\</TargetFilename> <!--Windows startup Folder-->
	<!--Windows WMI -->		
        <TargetFilename name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\Windows\System32\Wbem</TargetFilename>
        <TargetFilename name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\Windows\SysWOW64\Wbem</TargetFilename>
        <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
	<!--Key file to Identify PsExec - PSEXEC-[Source Hostname]-[8 Unique Characters].key Version 2.8 and up-->
		<Rule groupRelation="and">
         <TargetFilename name="technique_id=T1570,technique_name=Lateral Movement - PSEXEC log file" condition="begin with">C:\Windows\PSEXEC-</TargetFilename> <!--Key files for PsExec-->
		 <TargetFilename condition="end with">.key</TargetFilename> <!--Key files for PsExec-->
        </Rule>
	<!--Windows Task folder and other -->
		<Image name="rundll32.exe file created" condition="image">rundll32.exe</Image> <!--Check file signatur and location-->
        <TargetFilename name="technique_id=T1053,technique_name=Scheduled Task" condition="begin with">C:\Windows\System32\Tasks</TargetFilename> <!--Check file signatur and location-->
        <TargetFilename name="technique_id=T1053,technique_name=Scheduled Task" condition="begin with">C:\Windows\Tasks\</TargetFilename> <!--Check file signatur and location-->
		</FileCreate>
    </RuleGroup>
	<!--File Create exclutions -->
	<RuleGroup name="" groupRelation="or">
    <FileCreate onmatch="exclude">
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files\Google\Chrome\Application\chrome.exe</Image> 
               <TargetFilename condition="contains">\Local\Google\Chrome\User Data\Default\Extensions\Temp</TargetFilename> <!--Exclude Filewrite logs from Chrome extension temp folder-->
            </Rule>
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files\Google\Chrome\Application\chrome.exe</Image> 
               <TargetFilename condition="end with">\computed_hashes.json</TargetFilename> <!--Exclude Filewrite logs from Chrome extension Jason files-->
            </Rule>
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image> 
               <TargetFilename condition="contains">\AppData\Local\Microsoft\Edge\User Data\Default\Extensions\Temp</TargetFilename> <!--Exclude Filewrite logs from Edge extension temp folder-->
            </Rule>
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image> 
               <TargetFilename condition="end with">\computed_hashes.json</TargetFilename> <!--Exclude Filewrite logs from Edge extension Jason files-->
            </Rule>
			<Rule groupRelation="and">
               <Image condition="is">C:\Program Files\Mozilla Firefox\firefox.exe</Image> 
               <TargetFilename condition="end with">.default-release\extensions.json.tmp</TargetFilename> <!--Exclude Filewrite logs from Firefox extension temp folder-->
            </Rule>
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files\Mozilla Firefox\firefox.exe</Image> 
               <TargetFilename condition="end with">.default-release\extensions\trash</TargetFilename> <!--Exclude Filewrite logs from Firefox extension trash files-->
            </Rule>
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image> 
               <TargetFilename condition="contains">\AppData\Local\Microsoft\Edge\User Data\ZxcvbnData\</TargetFilename> <!--Exclude Edge from writing password.txt files in tmp folder-->
            </Rule>
            <Rule groupRelation="and">
               <Image condition="is">C:\Program Files\Microsoft CRM Email\Service\Microsoft.Crm.Tools.EmailAgent.exe</Image> 
               <TargetFilename condition="begin with">C:\Windows\Temp\</TargetFilename> <!--Exclude Crm.Tools.EmailAgent.exe files in tmp folder-->
            </Rule>			
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Update -->
				<Image condition="begin with">C:\$WinREAgent</Image> 
				<Image condition="excludes any">svchost.exe;wuaucltcore.exe;dismhost.exe;wuauclt.exe</Image>
			</Rule>
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Update-->
				<Image condition="begin with">C:\$WINDOWS.~BT</Image>
				<Image condition="excludes any">SetupHost.Exe;WindowsUpdateBox.Exe;dismhost.exe;mighost.exe;setup.exe;SetupPlatform.exe;SetupPrep.exe</Image>
			</Rule>
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Update-->
				<Image condition="begin with">C:\$Windows.~WS</Image>
				<Image condition="excludes any">MicrosoftEdge_X64;MicrosoftEdgeUpdateSetup_X86</Image>
			</Rule>
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Edge Update-->
				<Image condition="begin with">C:\Program Files (x86)\Microsoft\EdgeUpdate\Install</Image>
				<Image condition="excludes any">MicrosoftEdgeUpdateSetup_X86;SMicrosoftEdge_X64</Image>
			</Rule>
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Edge Update-->
				<Image condition="begin with">C:\Program Files (x86)\Microsoft\EdgeWebView\Application</Image>
				<Image condition="excludes any">msedgewebview2.exe;SetupHost.exe;setup.exe</Image>
			</Rule>
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Update-->
				<Image condition="begin with">C:\Windows\SoftwareDistribution</Image>
				<Image condition="excludes any">WindowsUpdateBox.Exe;unifiedinstaller.exe;windowsdesktop-runtime;Windows-KB</Image>
			</Rule>			
			<Rule name="" groupRelation="and"> <!-- Microsoft Windows Defender-->
				<Image condition="end with">C:\ProgramData\Microsoft\Windows Defender\Platform</Image>
				<Image condition="excludes any">DismHost.exe</Image>
			</Rule>			
         </FileCreate>
		 </RuleGroup>
<!-- Event ID 12,13,14 == RegObject added/deleted, RegValue Set, RegObject Renamed. -->
	<RuleGroup name="" groupRelation="or">
      <RegistryEvent onmatch="include">
	 <!-- Modify System Certificates -->
		<Rule name="technique_id=T1138,technique_name=Detect System Certificate Modifications - Registry" groupRelation="and"> <!--REF: ionstorm detection rule -->  
			<TargetObject condition="contains any">\Software\Policies\Microsoft\SystemCertificates\;\SOFTWARE\Microsoft\EnterpriseCertificates\;HKLM\SOFTWARE\Microsoft\SystemCertificates\;HKLM\Software\Microsoft\Cryptography\Services\ServiceName\SystemCertificates\</TargetObject>
			<EventType condition="is not">CreateKey</EventType>
			<Image condition="excludes">C:\WINDOWS\Sysmon64.exe</Image>
			<Image condition="excludes">C:\WINDOWS\Sysmon.exe</Image>
			<Image condition="excludes">C:\WINDOWS\system32\certsrv.exe</Image>
			<Image condition="excludes">C:\WINDOWS\system32\CompatTelRunner.exe</Image>
			<Image condition="excludes">C:\WINDOWS\system32\svchost.exe</Image>
			<Image condition="excludes">C:\Windows\SysWOW64\SearchProtocolHost.exe</Image>
			<Image condition="excludes">C:\Windows\system32\SearchProtocolHost.exe</Image>
			<Image condition="excludes">C:\Windows\system32\taskhost.exe</Image>
			<Image condition="excludes">C:\windows\SysWOW64\svchost.exe</Image>
			<Image condition="excludes">C:\WINDOWS\System32\DriverStore\FileRepository\asus</Image>
			<Image condition="excludes">C:\ProgramData\Microsoft\Windows Defender\Platform\</Image>
			<Image condition="excludes">C:\Program Files\ASUS\ARMOURY CRATE Service\ArmouryCrate.Service.exe</Image>
			<Image condition="excludes">C:\Program Files\NVIDIA Corporation\NvContainer\nvcontainer.exe</Image>
		</Rule>		
	<!--Application Shimming-->
	    <TargetObject name="technique_id=T1138,technique_name=Application Shimming" condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB</TargetObject>
        <TargetObject name="technique_id=T1138,technique_name=Application Shimming" condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom</TargetObject>
	<!--SIP and Trust Provider Hijacking-->
	    <TargetObject name="technique_id=T1198,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\OID</TargetObject>
        <TargetObject name="technique_id=T1198,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID</TargetObject>
        <TargetObject name="technique_id=T1198,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\Providers\Trust</TargetObject>
        <TargetObject name="technique_id=T1198,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\Providers\Trust</TargetObject>
	<!--Service Execution-->
	    <TargetObject name="technique_id=T1035,technique_name=Service Execution" condition="end with">\PsExec\EulaAccepted</TargetObject>
		<TargetObject name="technique_id=T1035,technique_name=Service Execution" condition="end with">\PsLogList\EulaAccepted</TargetObject>
		<TargetObject name="technique_id=T1035,technique_name=Service Execution" condition="end with">\PsService\EulaAccepted</TargetObject>
	<!--User Discovery-->
		<TargetObject name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="end with">\PsGetSID\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="end with">\PsLoggedOn\EulaAccepted</TargetObject>
	<!--Image File Execution Options Injection-->
	    <TargetObject name="technique_id=T1183,technique_name=Image File Execution Options Injection" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
        <TargetObject name="technique_id=T1183,technique_name=Image File Execution Options Injection" condition="begin with">HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
	<!--Account Manipulation-->
		<TargetObject name="technique_id=T1098,technique_name=Account Manipulation" condition="end with">\PsPasswd\EulaAccepted</TargetObject>
		<TargetObject name="technique_id=T1098,technique_name=Account Manipulation" condition="contains">\services\Netlogon\Parameters\DisablePasswordChange</TargetObject>
	<!--Remote Desktop Protocol-->
		<TargetObject name="technique_id=T1021.001,technique_name=Remote Desktop Protocol" condition="is">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\MaxInstanceCount</TargetObject><!--rdp_logon change max limit of current useres default 2 -->
        <TargetObject name="technique_id=T1021.001,technique_name=Remote Desktop Protocol" condition="is">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\RaunSolicit</TargetObject><!--rdp_logon This setting controls whether unsolicited offers of help to this computer are allowed. This has the possibility of allowing unauthorized users access to a system.-->
	<!--Office Application Startup-->		
		<TargetObject name="technique_id=T1137.002,technique_name=Office Application Startup - Persistence Office Test" condition="contains">\SOFTWARE\Microsoft\Office Test\Special\Perf\</TargetObject> <!-- Registry - Persistence - impacket-smbclient - Validate file and path -->
	<!--Command and Scripting Interpreter-->
		<TargetObject name="technique_id=T1059,technique_name=Command and Scripting Interpreter" condition="contains">\shell\install\command</TargetObject> <!--Command and Scripting Interpreter -->
        <TargetObject name="technique_id=T1059,technique_name=Command and Scripting Interpreter" condition="contains">\shell\open\command</TargetObject> <!--Command and Scripting Interpreter -->
        <TargetObject name="technique_id=T1059,technique_name=Command and Scripting Interpreter" condition="contains">\shell\open\ddeexec</TargetObject> <!--Command and Scripting Interpreter -->
	<!--Logon scripts-->
		<TargetObject name="technique_id=T1037,technique_name=Logon Scripts" condition="contains">\Windows\System\Scripts</TargetObject>	
		<TargetObject name="technique_id=T1037,technique_name=Logon Scripts" condition="contains">\Group Policy\Scripts</TargetObject>
	<!--COM Hijacking -->
		<TargetObject name="technique_id=T1546,technique_name=Component Object Model Hijacking" condition="end with">\InprocServer32\(Default)</TargetObject> <!--COM Hijacking - Keys -->
		<TargetObject name="technique_id=T1546,technique_name=Component Object Model Hijacking" condition="contains">{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}</TargetObject> <!--COM Hijacking - Keys -->
	<!--USB Hardware Monitor--> 
		<Rule name="technique_id=T1052,technique_name=Limit Hardware Installation - USBSTOR" groupRelation="and"> <!--USBSTOR-->
			<TargetObject condition="contains">HKLM\System\CurrentControlSet\Enum\USBSTOR</TargetObject>
			<TargetObject condition="contains any">FriendlyName;HardwareID;Service;Mfg:DeviceDesc</TargetObject> 			
		</Rule>
		<Rule name="technique_id=T1052,technique_name=Limit Hardware Installation - USB" groupRelation="and"> <!--USB-->
			<TargetObject condition="contains">HKLM\System\CurrentControlSet\Enum\USB\VID_</TargetObject>
			<TargetObject condition="contains any">HardwareID;Service;Mfg;DeviceDesc</TargetObject> 			
		</Rule>
		<Rule name="technique_id=T1052,technique_name=Limit Hardware Installation - USB HID" groupRelation="and"> <!--USB HID-->
			<TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\Enum\HID\VID_</TargetObject>
			<TargetObject condition="contains any">HardwareID;Service;Mfg;DeviceDesc</TargetObject>
		</Rule>
	<!--DHCP IPv4 monitor--> 
		<Rule name="technique_id=T1016,technique_name=Network Configuration Discovery - IPv4" groupRelation="and"> <!--IPV4 - Monitor for DHCP IPv4 -->
			<TargetObject condition="contains">HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces</TargetObject> 
			<TargetObject condition="contains any">DhcpDefaultGateway;DhcpDomain;DhcpIPAddress;DhcpNameServer;DhcpServer;DhcpSubnetMask;EnableDHCP;DhcpGatewayHardware</TargetObject>
			<TargetObject condition="excludes">DhcpGatewayHardwareCount</TargetObject>
		</Rule>
	<!--DHCP IPv6 monitor--> 
		<Rule name="technique_id=T1016,technique_name=Network Configuration Discovery - IPv6" groupRelation="and"> <!--IPV6 - Monitor for DHCP IPv6 -->
			<TargetObject condition="contains">HKLM\System\CurrentControlSet\Services\Tcpip6\Parameters\Interfaces</TargetObject> 
			<TargetObject condition="contains any">DhcpDefaultGateway;DhcpDomain;DhcpIPAddress;DhcpNameServer;DhcpServer;DhcpSubnetMask;EnableDHCP;DhcpGatewayHardware</TargetObject>
			<TargetObject condition="excludes">DhcpGatewayHardwareCount</TargetObject>
		</Rule>
	 <!--Autoruns and startup-->
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">\CurrentVersion\Run</TargetObject>	<!--Microsoft:Windows: Run keys, incld RunOnce, RunOnceEx, RunServices, RunServicesOnce [Also covers terminal server] -->
		<TargetObject name="technique_id=T1037,technique_name=Boot or Logon Initialization Scripts - Autoruns" condition="contains">\Windows\System\Scripts</TargetObject><!--Microsoft:Windows: Logon, Loggoff, Shutdown-->
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">\Policies\Explorer\Run</TargetObject><!--Microsoft:Windows -->
		<TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL - Autoruns" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify</TargetObject><!--Microsoft:Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
		<TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL - Autoruns" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit</TargetObject><!--Microsoft:Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
		<TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL - Autoruns" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell</TargetObject>
		<TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL - Autoruns" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\VmApplet</TargetObject>
		<TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL - Autoruns" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Specialaccounts\userlist</TargetObject>
		<TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL - Autoruns" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Uihostl</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\BootExecute</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\excludefromknowndlls</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\safedllsearchmode</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\setupexecute</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Startup</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains all">software\microsoft\windows nt\currentversion\accessibility\ATs\;\StartExe</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">software\microsoft\windows nt\currentversion\windows\run\</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU\</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">software\microsoft\windows\currentversion\explorer\shell folders\common startup</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="contains">software\microsoft\windows\currentversion\explorer\shell folders\startup</TargetObject>
		<TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder - Autoruns" condition="begin with">hklm\software\microsoft\command processor\autorun</TargetObject>
	<!--WMI - Windows Management Instrumentation-->
	    <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains">SYSTEM\CurrentControlSet\Control\CrashControl</TargetObject> <!--WMI - Windows Management Instrumentation -->
		<TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains">SYSTEM\CurrentControlSet\Control\CrashControl</TargetObject> <!-- Win32_OSRecoveryConfiguration class C2 maps to a change in values within the following key: -->
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\autologger\senseauditlogger</TargetObject> <!--WMI - Windows Management Instrumentation -->
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\autologger\senseeventlog</TargetObject> <!--WMI - Windows Management Instrumentation -->
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\EtwMaxLoggers</TargetObject> <!--WMI - Windows Management Instrumentation -->
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\Security</TargetObject> <!--WMI - Windows Management Instrumentation -->
	<!--Disable Windows Event Logging -->
	    <TargetObject name="technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">\SYSTEM\;\Service\EventLog;Retention</TargetObject> <!--Disable Windows Event Logging-->
        <TargetObject name="technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">\SYSTEM\;\Service\EventLog;MaxSize</TargetObject> <!--Disable Windows Event Logging-->
	<!--Disableing security services Impair Defenses -->
		<Rule name="technique_id=T1562,technique_name=Disable or Modify Tools - Taskmanager Disabled" groupRelation="and"> <!--Taskmanager Disabled - Often used by malware like DC-RAT-->
			<EventType condition="is">SetValue</EventType>		
			<TargetObject condition="contains">\Software\Microsoft\Windows\CurrentVersion\Policies</TargetObject>
			<TargetObject condition="contains">DisableTaskMgr</TargetObject>
			<Details condition="contains">DWORD (0x00000001)</Details>
		</Rule>		
		<Rule name="technique_id=T1562,technique_name=Disable or Modify Tools - Sysmon Driver Disabled" groupRelation="and"> <!--Sysmon Driver Disabled-->
			<EventType condition="is">SetValue</EventType>		
			<TargetObject condition="contains">SYSTEM\CurrentControlSet\services\SysmonDrv</TargetObject>
			<TargetObject condition="contains">Start</TargetObject>
			<Details condition="contains any">DWORD (0x00000001);DWORD (0x00000002);DWORD (0x00000003);DWORD (0x00000004)</Details>
		</Rule>		
		<Rule name="technique_id=T1562,technique_name=Disable or Modify Tools - Sysmon Service Disabled - TaskhostView " groupRelation="and"> <!--Sysmon Service TaskhostView Disabled-->
			<EventType condition="is">SetValue</EventType>		
			<TargetObject condition="contains">SYSTEM\CurrentControlSet\services\TaskhostView</TargetObject>
			<TargetObject condition="contains">Start</TargetObject>
			<Details condition="contains any">DWORD (0x00000000);DWORD (0x00000001);DWORD (0x00000003);DWORD (0x00000004)</Details>
		</Rule>		
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Sense" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\Sense</TargetObject> <!--Security services Windows Defender Advanced Threat Protection Service disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - WinDefend Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WinDefend</TargetObject> <!--Security services Microsoft Defender Antivirus Service disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Microsoft Protection Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\MsMpSvc</TargetObject> <!--Security services Microsoft Malware Protection Service disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Realtime Inspection Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\NisSrv</TargetObject> <!--Security services Microsoft Network Realtime Inspection Service disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Windows Defender Boot Driver" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WdBoot</TargetObject> <!--Security services Microsoft Defender Antivirus Boot Driver disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools -  Windows Defender Network Inspection System" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WdNisDrv</TargetObject> <!--Security services Microsoft Defender Antivirus Network Inspection System Driver disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Windows Defender Network Inspection Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WdNisSvc</TargetObject> <!--Security services Microsoft Defender Antivirus Network Inspection System Driver disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Security Center Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\wscsvc</TargetObject> <!--Security services Security Center disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Windows Security Health Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SecurityHealthService</TargetObject> <!--Security services Windows Security Health Service disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Windows Update Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\wuauserv</TargetObject> <!--Security services Windows Update disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1562,technique_name=Disable or Modify Tools - Windows Update Service" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\UsoSvc</TargetObject> <!--Security services Update Orchestrator Service disabled-->
		<Details condition="contains">DWORD (0x00000004)</Details>
		</Rule>	
		<Rule groupRelation="and">
			<TargetObject name="technique_id=T1553,technique_name=Subvert Trust Controls - Disable Root Certificate Update" condition="begin with">HKLM\Software\Policies\Microsoft\SystemCertificates\AuthRoot\DisableRootAutoUpdate</TargetObject> <!--Manually disabling Root Certificate Update-->
		<Details condition="contains">DWORD (0x00000001)</Details>
		</Rule>	
		<Rule name="technique_id=T1562,technique_name=Disable or Modify Tools - LSA Disabled" groupRelation="and"> <!--LSA disabled-->
			<TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\RunAsPPL</TargetObject>
			<Details condition="contains">DWORD (0x00000000)</Details>
		</Rule>	
	<!--Windows Defender tampering -->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\AntiVirusDisableNotify</TargetObject> <!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiSpyware</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiVirus</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableBehaviorMonitoring</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableOnAccessProtection</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableScanOnRealtimeEnable</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableIOAVProtection</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableRealtimeMonitoring</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet\SpyNetReporting</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="contains all">HKLM\software\microsoft\microsoft antimalware\exclusions\</TargetObject><!--Windows Defender-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Windows Defender" condition="begin with">HKLM\software\policies\microsoft\windows advanced threat protection\</TargetObject><!--Windows Defender-->
	<!--Microsoft Firewall tampering-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Firewall" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\AuthorizedApplications\List</TargetObject><!--Microsoft Firewall tampering-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Firewall" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\FirewallDisableNotify</TargetObject><!--Microsoft Firewall tampering-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Firewall" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\FirewallOverride</TargetObject><!--Microsoft Firewall tampering-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Firewall" condition="begin with">HKLM\software\policies\microsoft\windowsfirewall\;\authorizedapplications</TargetObject><!--Microsoft Firewall tampering-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Firewall" condition="begin with">HKLM\software\policies\microsoft\windowsfirewall\;\authorizedapplications\list</TargetObject><!--Microsoft Firewall tampering-->
		<TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Firewall" condition="begin with">HKLM\software\policies\microsoft\windowsfirewall\;\globallyopenports</TargetObject><!--Microsoft Firewall tampering-->
	<!--Disabling Security Tools Features -->		
		<TargetObject name="technique_id=T1089,technique_name=Disabling Security Tools - Windows Update" condition="is">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Setup\ServiceStartup</TargetObject> <!--Disable windows update-->
		<TargetObject name="technique_id=T1098,technique_name=Account Manipulation" condition="contains">\services\Netlogon\Parameters\DisablePasswordChange</TargetObject> <!--Microsoft:disable_password_change-->
	<!--Disabling office security features -->
		<TargetObject name="technique_id=T1562,technique_name=Disabling office security features" condition="end with">\VBAWarnings</TargetObject> <!--Microsoft:Office:Security _features--> 
		<TargetObject name="technique_id=T1562,technique_name=Disabling office security features" condition="end with">\DisableInternetFilesInPV</TargetObject> <!--Microsoft:Office:Security _features-->
		<TargetObject name="technique_id=T1562,technique_name=Disabling office security features" condition="end with">\DisableUnsafeLocationsInPV</TargetObject> <!--Microsoft:Office:Security _features-->
		<TargetObject name="technique_id=T1562,technique_name=Disabling office security features" condition="end with">\DisableAttachementsInPV</TargetObject> <!--Microsoft:Office:Security _features-->
		<TargetObject name="technique_id=T1137.001,technique_name=Office Application Startup: Office Template Macros" condition="contains">Security\Trusted Documents\TrustRecords</TargetObject> <!--REF: https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ -->
	<!--Sysinternals tools -->
        <TargetObject name="technique_id=T1569.002,technique_name=Service Execution - Sysinternals" condition="end with">\PsExec\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1105,technique_name=Ingress Tool Transfer - Sysinternals" condition="end with">\PsFile\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1033,technique_name=System Owner/User Discovery - Sysinternals" condition="end with">\PsGetSID\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1057,technique_name=Process Discovery - Sysinternals" condition="end with">\PsInfo\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools - Sysinternals " condition="end with">\PsKill\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1057,technique_name=Process Discovery - Sysinternals" condition="end with">\PsList\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1033,technique_name=System Owner/User Discovery - Sysinternals" condition="end with">\PsLoggedOn\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1569.002,technique_name=Service Execution - Sysinternals" condition="end with">\PsLogList\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1098,technique_name=Account Manipulation - Sysinternals" condition="end with">\PsPasswd\EulaAccepted</TargetObject> <!--Sysinternals-->
        <TargetObject name="technique_id=T1569.002,technique_name=Service Execution - Sysinternals" condition="end with">\PsService\EulaAccepted</TargetObject> <!--Sysinternals-->
	<!--Bypass User Account Control -->
		<TargetObject name="technique_id=T1548,technique_name=Abuse Elevation Control Mechanism" condition="contains">\Software\Microsoft\Windows\CurrentVersion\App Paths\</TargetObject> <!-- Bypass User Account Control -->
	    <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="contains">\mscfile\shell\open\command</TargetObject>
        <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="contains">ms-settings\shell\open\command</TargetObject>
        <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="contains">Classes\exefile\shell\runas\command\isolatedCommand</TargetObject>
	    <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA</TargetObject> <!--Bypass User Account Control -->
        <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy</TargetObject> <!--Bypass User Account Control -->
        <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\UacDisableNotify</TargetObject> <!--Bypass User Account Control -->
        <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\UpdatesDisableNotify</TargetObject> <!--Bypass User Account Control -->
		<Rule groupRelation="and">
          <TargetObject name="technique_id=T1088,technique_name=Bypass User Account Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</TargetObject> <!--Bypass User Account Control -->
          <Image condition="is not">C:\Windows\System32\svchost.exe</Image>
		</Rule>	
      </RegistryEvent>
    </RuleGroup>	
<!-- Event ID 15 == FileStream Created - Mark of the web -->
	<RuleGroup name="" groupRelation="or">
      <FileCreateStreamHash onmatch="exclude">
		</FileCreateStreamHash>
    </RuleGroup>	
<!--Event ID 17,18 - Exclude - PipeEvent. Log Named pipe created & Named pipe connected -->
	<RuleGroup name="" groupRelation="or">
	 <PipeEvent onmatch="exclude">
	  <Rule groupRelation="and">
        <Image condition="contains">\SplunkUniversalForwarder\</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>	   
	  <Rule groupRelation="and">
        <Image condition="end with">\Spyder\Python\pythonw.exe</Image>
        <PipeName condition="begin with">\mojo.</PipeName>
       </Rule>	   
	   <Rule groupRelation="and">
        <Image condition="end with">\wbem\wmiprvse.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\WINDOWS\Explorer.EXE</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>	   	   
	   <Rule groupRelation="and">
        <Image condition="end with">\System32\RuntimeBroker.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\System32\spoolsv.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>   
	   <Rule groupRelation="and">
        <Image condition="end with">\system32\svchost.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\Microsoft\Teams\current\Teams.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\slack.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\Microsoft\OneDrive\OneDrive.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\system32\mstsc.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\Dashboard\widgetservice.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\PhoneExperienceHost.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\system32\services.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\PhoneExperienceHost.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\VMware Workstation\vmware.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\Mozilla Thunderbird\thunderbird.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\svchost.exe</Image>
        <PipeName condition="begin with">\TSVCPIPE-12a75c0b</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\LibreOffice\program\soffice.bin</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\Mozilla Firefox\firefox.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\System32\SearchProtocolHost.exe</Image>
        <PipeName condition="begin with">\srvsvc</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\ORACLE.EXE</Image>
        <PipeName condition="begin with">\ORANTPE</PipeName>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\System32\SECOMN64.exe</Image>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\SmartSense.exe</Image>
       </Rule>
	   <Rule groupRelation="and">
        <Image condition="end with">\Microsoft VS Code\Code.exe</Image>
       </Rule>	   
	  </PipeEvent>
    </RuleGroup>	
<!--Event ID 17,18 - Included - PipeEvent. Log Named pipe created & Named pipe connected -->
	<RuleGroup groupRelation="or">
      <PipeEvent onmatch="include">	  
		<Rule groupRelation="and">
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msse-</PipeName> <!-- default cobalt strike pipe name-->
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="end with">-server</PipeName>  <!-- default cobalt strike pipe name-->
        </Rule>		
		<Rule groupRelation="and">
        <PipeName name="technique_id=T1059.001,technique_name=PowerShell" condition="begin with">\PSHost</PipeName> <!-- PowerShell-->
        <Image condition="is not">powershell.exe</Image>
        </Rule>
        <Rule groupRelation="and">
        <PipeName name="technique_id=T1059.001,technique_name=PowerShell" condition="begin with">\PSHost</PipeName> <!-- PowerShell-->
        <Image condition="is not">powershell_ise.exe</Image>
        </Rule>		
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msagent_</PipeName> <!-- default cobalt strike pipe name-->
        <PipeName name="technique_id=T1055; Possible Cobalt Strike post-exploitation jobs." condition="begin with">\postex_</PipeName> <!-- default cobalt strike pipe name-->
        <PipeName name="technique_id=T1021.004,technique_name=Remote Services: SSH" condition="begin with">\postex_ssh_</PipeName> <!-- default cobalt strike pipe name-->
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\status_</PipeName> <!-- default cobalt strike pipe name-->
		<PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\gruntsvc</PipeName> <!-- default covenant pipe name-->
		<PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\svcctl</PipeName> <!-- default covenant pipe name-->
		<PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msf-pipe</PipeName> <!-- default metasploit pipe name-->
		<PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\PSEXESVC</PipeName> <!-- default psexec pipe name-->
		<PipeName name="technique_id=T1021,technique_name=Named Pipe - srvsvc" condition="begin with">\srvsvc</PipeName>  <!--session enumeration - Named Pipe-->
		<PipeName name="technique_id=T1021,technique_name=Named Pipe - TSVCPIPE" condition="begin with">\TSVCPIPE</PipeName> <!--tsvcpipe - Named Pipe-->
		<PipeName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="begin with">\winreg</PipeName>  <!--also used in lateral movement-->
		<PipeName name="technique_id=T1570,technique_name=Lateral Tool Transfer - RemCom" condition="contains">remcom_comunication</PipeName>  <!--REF: https://redcanary.com/blog/threat-hunting-psexec-lateral-movement/-->
		<PipeName name="technique_id=T1570,technique_name=Lateral Tool Transfer - PAExec" condition="contains">PAExec</PipeName>  <!--REF: https://redcanary.com/blog/threat-hunting-psexec-lateral-movement/-->
		<PipeName name="technique_id=T1570,technique_name=Lateral Tool Transfer - CSExec" condition="contains">csexecsvc</PipeName>  <!--REF: https://redcanary.com/blog/threat-hunting-psexec-lateral-movement/-->
      </PipeEvent>
    </RuleGroup> 
<!-- Event ID 19,20,21, == WmiEvent. Log all WmiEventFilter, WmiEventConsumer, WmiEventConsumerToFilter activity-->
	<RuleGroup name="" groupRelation="or">
      <WmiEvent onmatch="include">
        <Operation name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">Created</Operation>
      </WmiEvent>
    </RuleGroup>
<!--EVENT 22: "Dns query" -->
    <RuleGroup groupRelation="or">
      <DnsQuery onmatch="exclude">	  
	<!--Adds Noice -->
	    <QueryName condition="end with">.adform.net</QueryName>
        <QueryName condition="end with">.adnxs.com</QueryName>
        <QueryName condition="end with">.adsrvr.org</QueryName>
        <QueryName condition="end with">.advertising.com</QueryName>
        <QueryName condition="end with">.amazon-adsystem.com</QueryName>
        <QueryName condition="end with">.chartbeat.net</QueryName>
        <QueryName condition="end with">.doubleclick.net</QueryName>
        <QueryName condition="end with">.doubleverify.com</QueryName>
		<QueryName condition="end with">.google-analytics.com</QueryName>
        <QueryName condition="end with">.googleadservices.com</QueryName>
        <QueryName condition="end with">.googlesyndication.com</QueryName>
        <QueryName condition="end with">.googletagmanager.com</QueryName>
		<QueryName condition="end with">.ib-ibi.com</QueryName>
        <QueryName condition="end with">.jivox.com</QueryName>
        <QueryName condition="end with">.mathtag.com</QueryName>
        <QueryName condition="end with">.moatpixel.com</QueryName>
        <QueryName condition="end with">.optimizely.com</QueryName>
		<QueryName condition="end with">.pinterest.com</QueryName>
        <QueryName condition="end with">.ytimg.com</QueryName>
		<QueryName condition="end with">.symcd.com</QueryName>
        <QueryName condition="is">adservice.google.com</QueryName>
	<!--Adobe -->
	    <QueryName condition="end with">.adobe.com</QueryName>
	<!--Apple -->
	    <QueryName condition="end with">.apple.com</QueryName>
	<!--Certificate -->
	    <QueryName condition="end with">.digicert.com</QueryName>
        <QueryName condition="end with">.globalsign.com</QueryName>
        <QueryName condition="end with">.globalsign.net</QueryName>
        <QueryName condition="end with">.msocsp.com</QueryName>
        <QueryName condition="end with">.pki.goog</QueryName>
        <QueryName condition="end with">.godaddy.com</QueryName>
        <QueryName condition="end with">amazontrust.com</QueryName>
        <QueryName condition="end with">.sectigo.com</QueryName>
		<QueryName condition="end with">.usertrust.com</QueryName>
		<QueryName condition="end with">ocsp.identrust.com</QueryName>
		<QueryName condition="end with">ocsp.identrust.com</QueryName>
		<QueryName condition="end with">crl.comodoca.com</QueryName>
		<QueryName condition="end with">sb-ssl.l.google.com</QueryName>
		<QueryName condition="is">pki-goog.l.google.com</QueryName>
        <QueryName condition="is">ocsp.comodoca.com</QueryName>
        <QueryName condition="is">ocsp.verisign.com</QueryName>
        <QueryName condition="is">ocsp.entrust.net</QueryName>
        <QueryName condition="is">status.rapidssl.com</QueryName>
        <QueryName condition="is">status.thawte.com</QueryName>
        <QueryName condition="is">ocsp.int-x3.letsencrypt.org</QueryName>
        <QueryName condition="is">subca.ocsp-certum.com</QueryName>
        <QueryName condition="is">cscasha2.ocsp-certum.com</QueryName>
	<!--Common -->
		<QueryName condition="is">slack-imgs.com</QueryName>
		<QueryName condition="is">a.slack-edge.com</QueryName>
		<QueryName condition="is">slackb.com</QueryName>
		<QueryName condition="end with">slack.com</QueryName>
	    <QueryName condition="end with">.netflix.com</QueryName>
	    <QueryName condition="end with">.akadns.net</QueryName>
		<QueryName condition="end with">ntp.org</QueryName>
		<QueryName condition="end with">.spotify.com</QueryName>
        <QueryName condition="end with">.akamai.net</QueryName>
		<QueryName condition="end with">.lencr.org</QueryName>
		<QueryName condition="end with">.facebook.com</QueryName>
		<QueryName condition="end with">.recaptcha.net</QueryName>
		<QueryName condition="end with">.mobilepay.dk</QueryName>
		<QueryName condition="end with">.borger.dk</QueryName>
		<QueryName condition="end with">.cloudfront.net</QueryName>
		<QueryName condition="end with">.citrix.com</QueryName>
	    <QueryName condition="end with">.dr.dk</QueryName>
		<QueryName condition="end with">.tv2.dk</QueryName>
		<QueryName condition="end with">.facebook.com</QueryName>
		<QueryName condition="end with">.citrix.com</QueryName>
		<QueryName condition="end with">.trafficmanager.net</QueryName>
		<QueryName condition="end with">.twitter.com</QueryName>	
		<QueryName condition="end with">.instagram.com</QueryName>
		<QueryName condition="end with">.linkedin.com</QueryName>
		<QueryName condition="end with">.virustotal.com</QueryName>
		<QueryName condition="end with">.danskebank.dk</QueryName>
		<QueryName condition="end with">.danskebank.com</QueryName>
		<QueryName condition="end with">.mitid.dk</QueryName>
		<QueryName condition="end with">.e-boks.com</QueryName>
		<QueryName condition="end with">.nemid.nu</QueryName>	
		<QueryName condition="end with">.jyskebank.dk</QueryName>
		<QueryName condition="end with">.sydbank.dk</QueryName>
		<QueryName condition="end with">.nykredit.dk</QueryName>
		<QueryName condition="end with">.sparnord.dk</QueryName>
		<QueryName condition="end with">.al-bank.dk</QueryName>
		<QueryName condition="end with">.landbobanken.dk</QueryName>
		<QueryName condition="end with">.spard.dk</QueryName>
		<QueryName condition="end with">.home.saxo</QueryName>
		<QueryName condition="end with">.vestjyskbank.dk</QueryName>
		<QueryName condition="end with">.splunkdev.net</QueryName>
		<QueryName condition="end with">.superoffice.com</QueryName>
	<!--Cloudflare -->
	    <QueryName condition="is">cdnjs.cloudflare.com</QueryName>
	<!--Google -->
	    <QueryName condition="end with">.googlevideo.com</QueryName>
        <QueryName condition="end with">.gstatic.com</QueryName>
        <QueryName condition="end with">.gvt1.com</QueryName>
        <QueryName condition="end with">.gvt2.com</QueryName>
		<QueryName condition="end with">.googleusercontent.com</QueryName>
		<QueryName condition="is">ampcid.google.com</QueryName>
        <QueryName condition="is">imasdk.googleapis.com</QueryName>
		<QueryName condition="is">ajax.googleapis.com</QueryName>
        <QueryName condition="is">l.google.com</QueryName>
        <QueryName condition="is">mtalk.google.com</QueryName>
        <QueryName condition="is">update.googleapis.com</QueryName>
        <QueryName condition="is">www.googletagservices.com</QueryName>
		<QueryName condition="is">consent.google.com</QueryName>
		<QueryName condition="is">gstaticadssl.l.google.com</QueryName>
		<QueryName condition="is">clients1.google.com</QueryName>
        <QueryName condition="is">clients2.google.com</QueryName>
        <QueryName condition="is">clients3.google.com</QueryName>
        <QueryName condition="is">clients4.google.com</QueryName>
        <QueryName condition="is">clients5.google.com</QueryName>
        <QueryName condition="is">clients6.google.com</QueryName>
		<QueryName condition="is">apis.google.com</QueryName>
		<QueryName condition="is">plus.l.google.com</QueryName>
		<QueryName condition="is">dns.google.com</QueryName>
        <QueryName condition="is">safebrowsing.googleapis.com</QueryName>
		<QueryName condition="is">fonts.googleapis.com</QueryName>
		<QueryName condition="end with">.google-analytics.com</QueryName>
        <QueryName condition="end with">.googleadservices.com</QueryName>
        <QueryName condition="end with">.googlesyndication.com</QueryName>
        <QueryName condition="end with">.googletagmanager.com</QueryName>
	<!--Hardware vendors -->
	    <QueryName condition="end with">.nvidia.com</QueryName>
		<QueryName condition="end with">.intel.com</QueryName>
	  	<Rule groupRelation="and">
        <Image condition="is">C:\ProgramData\LogiShrd\LogiOptions\Software\Current\updater.exe</Image>
        <QueryName condition="end with">.logitech.com</QueryName>
        </Rule>
        <Image condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe</Image>		
	<!--local--> 
        <QueryName condition="end with">.localmachine</QueryName>
		<QueryName condition="end with">in-addr.arpa.</QueryName>
		<QueryName condition="end with">ip6.arpa.</QueryName>
		<QueryName condition="end with">ipv4only.arpa</QueryName>
		<QueryName condition="is">localhost</QueryName>
		<QueryName condition="is">wpad</QueryName>
		<QueryName condition="is">::</QueryName>
		<QueryName condition="is">255.0.0.0</QueryName>
		<QueryName condition="is">10.0.0.0</QueryName>		
		<QueryName condition="is">192.168.0.0</QueryName>
		<QueryName condition="is">172.16.0.0</QueryName>
		<QueryName condition="is">127.0.0.1</QueryName>
		<QueryName condition="is">127.0.0.0</QueryName>
		<QueryName condition="is">0.0.0.0</QueryName>
	<!--Microsoft"-->
	    <QueryName condition="end with">.azurewebsites.net</QueryName>
		<QueryName condition="end with">.msftncsi.com</QueryName>
	    <QueryName condition="end with">-pushp.svc.ms</QueryName>
		<QueryName condition="end with">.msedge.net</QueryName>
		<QueryName condition="end with">.msecnd.net</QueryName>
        <QueryName condition="end with">.b-msedge.net</QueryName>
		<QueryName condition="end with">.t-msedge.net</QueryName>
        <QueryName condition="end with">.bing.com</QueryName>
        <QueryName condition="end with">.hotmail.com</QueryName>
        <QueryName condition="end with">.live.com</QueryName>
        <QueryName condition="end with">.live.net</QueryName>
        <QueryName condition="end with">.s-microsoft.com</QueryName>
        <QueryName condition="end with">.microsoft.com</QueryName>
        <QueryName condition="end with">.microsoftonline.com</QueryName>
        <QueryName condition="end with">.microsoftstore.com</QueryName>
		<QueryName condition="end with">.ms-acdc.office.com</QueryName>
        <QueryName condition="end with">.msn.com</QueryName>
        <QueryName condition="end with">.msocdn.com</QueryName>
        <QueryName condition="end with">.skype.com</QueryName>
        <QueryName condition="end with">.skype.net</QueryName>
        <QueryName condition="end with">.windows.com</QueryName>
        <QueryName condition="end with">.windows.net.nsatc.net</QueryName>
        <QueryName condition="end with">.windowsupdate.com</QueryName>
        <QueryName condition="end with">.xboxlive.com</QueryName>
        <QueryName condition="end with">.windows.net</QueryName>
        <QueryName condition="end with">.windowsazure.com</QueryName>
        <QueryName condition="end with">.aria.microsoft.com</QueryName>
        <QueryName condition="end with">.msauth.net</QueryName>
        <QueryName condition="end with">.msftauth.net</QueryName>
        <QueryName condition="end with">.azure.com</QueryName>
        <QueryName condition="end with">.office365.com</QueryName>
        <QueryName condition="end with">.azure.com</QueryName>
        <QueryName condition="end with">.office.com</QueryName>
        <QueryName condition="end with">.office.net</QueryName>
		<QueryName condition="end with">.visualstudio.com</QueryName>
		<QueryName condition="end with">.sharepoint.com</QueryName>
		<QueryName condition="end with">.outlook.com</QueryName>
		<QueryName condition="end with">.msftconnecttest.com</QueryName>
		<QueryName condition="end with">.xboxab.com</QueryName>		
	<!--Mozilla"-->
	    <QueryName condition="end with">.mozaws.net</QueryName>
		<QueryName condition="end with">.mozgcp.net</QueryName>
        <QueryName condition="end with">.mozilla.com</QueryName>
        <QueryName condition="end with">.mozilla.net</QueryName>
        <QueryName condition="end with">.mozilla.org</QueryName>
		<QueryName condition="end with">.firefox.com</QueryName>
		<QueryName condition="end with">.thunderbird.net</QueryName>		
	<!--Youtube"-->
		<QueryName condition="is">youtube.com</QueryName>
		<QueryName condition="end with">.youtube.com</QueryName>
	<!--VmWare"-->
		<QueryName condition="end with">.vmware.com</QueryName>
		</DnsQuery>
    </RuleGroup>
<!-- Event ID 23 == FileDelete archived Include-->
	<RuleGroup name="" groupRelation="or">
		<FileDelete onmatch="include">
		</FileDelete>
	</RuleGroup>
<!-- Event ID 24 == Capture Clipboard -->
	<RuleGroup name="" groupRelation="or">
		<ClipboardChange onmatch="include">
		</ClipboardChange>
	</RuleGroup>
<!-- Event ID 25 == Process Tampering -->
	<RuleGroup name="Process_Tampering" groupRelation="or">
		<ProcessTampering onmatch="exclude">
		<Image condition="contains">unknown process</Image> <!--Unknowen process events-->
		<Image condition="is">C:\Windows\System32\wbem\WMIADAP.exe</Image> <!-- Update performance information in the WMI repositor-->
		<Image condition="is">C:\Program Files\Microsoft VS Code\Code.exe</Image> <!-- Visual Studio Code-->
		<Image condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunk-regmon.exe</Image> <!-- Splunk UniversalForwarder-->
		<Image condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunk-powershell.exe</Image> <!-- Splunk UniversalForwarder-->
		<Image condition="is">C:\git\bin\git.exe</Image> <!-- Distributed version control system-->
        <Image condition="is">C:\git\mingw64\bin\git.exe</Image> <!-- Distributed version control system-->
		<Image condition="is">C:\git\mingw64\libexec\git-core\git.exe</Image> <!-- Distributed version control system-->
		<Image condition="is">C:\Program Files\CapaSystems\COA\Tray\CapaOne.exe</Image> <!-- Capa One-->
		<Rule groupRelation="and">
          <Image condition="begin with">C:\Windows\System32\SecurityHealth\</Image> <!-- Monitoring and reporting on the security and health status -->
          <Image condition="end with">\SecurityHealthHost.exe</Image>
		</Rule>		
		</ProcessTampering>
	</RuleGroup>
<!-- Event ID 26 == File Delete Detected -->
	<RuleGroup name="FileDeleteDetected" groupRelation="or">
		<FileDeleteDetected onmatch="exclude">
			<Image condition="contains">\Mozilla Firefox\firefox.exe</Image> <!--Firefox deleting files in TEMP-->
			<Image condition="contains">\system32\cleanmgr.exe</Image> <!--cleanmgr deleting Dism files in TEMP-->
			<Image condition="contains">\MailServer\plugins\avserver\avserver.exe</Image> <!--Kerio AV mailserver deleting files in TEMP-->
			<Image condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunk-winevtlog.exe</Image> <!--Splunk deleting files in TEMP-->
			<Image condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</Image> <!--Splunk deleting files in TEMP-->
			<Image condition="is">C:\Windows\System32\sdiagnhost.exe</Image> <!--sdiagnhost deleting PS1 files in TEMP-->
		</FileDeleteDetected>
	</RuleGroup>	
<!-- Event ID 26 == File Delete Detected - Include-->
	<RuleGroup name="FileDeleteDetected" groupRelation="or">
		<FileDeleteDetected onmatch="include">
		<Rule name="technique_id=T1070.004,technique_name=File Deletion - User Download folder" groupRelation="and"> <!--User Download folder-->
			<TargetFilename condition="contains">\Downloads\</TargetFilename> 
            <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.pptm;.scr;.msi;.sct;.zip</TargetFilename>
        </Rule>
        <Rule name="technique_id=T1070.004,technique_name=File Deletion - User Temp folder" groupRelation="and"> <!--User Temp folder-->
			<TargetFilename condition="contains">\Appdata\Local\Temp\</TargetFilename> 
            <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.pptm;.scr;.msi;.sct;.zip</TargetFilename>
        </Rule>
        <Rule name="technique_id=T1070.004,technique_name=File Deletion - Outlook Temp folder" groupRelation="and"> <!--Microsoft Outlook Temp folder-->
			<TargetFilename condition="contains">\Appdata\Local\Microsoft\Windows\INetCache\Content.Outlook\</TargetFilename> 
            <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.pptm;.scr;.msi;.sct;.zip</TargetFilename>
         </Rule>
		<Rule name="technique_id=T1070.004,technique_name=File Deletion - Users Desktop" groupRelation="and"> <!--Users Desktop-->
			<TargetFilename condition="contains">\Desktop\</TargetFilename> 
            <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.pptm;.scr;.msi;.sct;.zip</TargetFilename>
        </Rule>		 
		 <Rule name="technique_id=T1070.004,technique_name=File Deletion - Kerio Mailservers" groupRelation="and"> <!--Kerio Mailservers-->
			<TargetFilename condition="contains">\MailServer</TargetFilename> 
            <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.pptm;.scr;.msi;.sct;.zip</TargetFilename>
         </Rule>		 
		</FileDeleteDetected>
	</RuleGroup>
<!-- Event ID 27 == File Block Executable -->
	  <RuleGroup name="FileBlockExecutable" groupRelation="or">
        <FileBlockExecutable onmatch="include">
		<!-- Executables dropped to suspicious folders -->
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Users Public" condition="begin with">C:\Users\Public\</TargetFilename> <!-- often used staging directories; could cause false positives --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Perflogs" condition="begin with">C:\Perflogs\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows Fonts" condition="begin with">C:\Windows\Fonts\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows Debug" condition="begin with">C:\Windows\debug\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows Tasks" condition="begin with">C:\Windows\Tasks\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows Tracing" condition="begin with">C:\Windows\tracing\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows Help" condition="begin with">C:\Windows\Help\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows Logs" condition="begin with">C:\Windows\Logs\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - spool servers" condition="begin with">C:\Windows\System32\spool\SERVERS\</TargetFilename> <!-- often used in exploits against print spooler --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - spool printers" condition="begin with">C:\Windows\System32\spool\PRINTERS\</TargetFilename> <!-- often used in exploits against print spooler --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Windows help" condition="begin with">C:\Windows\Help\</TargetFilename> <!-- often used staging directories --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Users Music" condition="contains all">C:\Users\;\Music\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Users Ppictures" condition="contains all">C:\Users\;\Pictures\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Users videos" condition="contains all">C:\Users\;\Videos\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Users contacts" condition="contains all">C:\Users\;\Contacts\</TargetFilename> <!-- often used staging directories in User folders --> 
			<TargetFilename name="technique_id=T1074.001,technique_name=Local Data Staging - Start menu startup" condition="contains all">C:\Users;\Microsoft\Windows\Start Menu\Programs\Startup\</TargetFilename>
		<!-- Unwanted Agent installation -->
			<TargetFilename name="technique_id=Known unwanted agent installation ,technique_name=Remote access - tailscale" condition="end with">\tailscale.exe</TargetFilename>
		<!-- Microsoft Office Programs Dropping Executables -->
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - winword" condition="image">winword.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - excel" condition="image">excel.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - powerpnt" condition="image">powerpnt.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - msaccess" condition="image">msaccess.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - mspub" condition="image">mspub.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - eqnedt32" condition="image">eqnedt32.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - visio" condition="image">visio.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - wordpad" condition="image">wordpad.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - wordview" condition="image">wordview.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - msohtmed" condition="image">msohtmed.exe</Image>
		<!-- Executables double extensions -->
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - pdf" condition="end with">.pdf.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - doc" condition="end with">.doc.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - docx" condition="end with">.docx.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - xls" condition="end with">.xls.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - xlsx" condition="end with">.xlsx.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - xlsm" condition="end with">.xlsm.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - docm" condition="end with">.docm.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - ppt" condition="end with">.ppt.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - pptx" condition="end with">.pptx.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - txt" condition="end with">.txt.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - rtf" condition="end with">.rtf.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - htm" condition="end with">.htm.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - html" condition="end with">.html.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - iso" condition="end with">.iso.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - zip" condition="end with">.zip.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - rar" condition="end with">.rar.exe</TargetFilename>
			<TargetFilename name="technique_id=T1036.007 ,technique_name=Masquerading Double File Extension - 7z" condition="end with">.7z.exe</TargetFilename>
		<!-- Tools that tamper with Sysmon -->
			<TargetFilename name="technique_id=Known Tool ,technique_name=Sysmon tampering - EntenLoader"  condition="end with">\EntenLoader.exe</TargetFilename>
			<TargetFilename name="technique_id=Known Tool ,technique_name=Sysmon tampering - SysmonQuiet"  condition="end with">\SysmonQuiet.exe</TargetFilename>
			<TargetFilename name="technique_id=Known Tool ,technique_name=Sysmon tampering - SharpEvtMute"  condition="end with">\SharpEvtMute.exe</TargetFilename>
			<TargetFilename name="technique_id=Known Tool ,technique_name=Sysmon tampering - EvtMuteHook"  condition="end with">\EvtMuteHook.dll</TargetFilename>
			<TargetFilename name="technique_id=Known Tool ,technique_name=Sysmon tampering - SysmonEOP"  condition="end with">\SysmonEOP.exe</TargetFilename>
		<!-- Hacktool Blocks based on Imphashes -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PetitPotam" condition="contains">IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932</Hashes> <!-- PetitPotam -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PetitPotam" condition="contains">IMPHASH=3A19059BD7688CB88E70005F18EFC439</Hashes> <!-- PetitPotam -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PetitPotam" condition="contains">IMPHASH=bf6223a49e45d99094406777eb6004ba</Hashes> <!-- PetitPotam -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=0C106686A31BFE2BA931AE1CF6E9DBC6</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=0D1447D4B3259B3C2A1D4CFB7ECE13C3</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=1B0369A1E06271833F78FFA70FFB4EAF</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=4C1B52A19748428E51B14C278D0F58E3</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=4D927A711F77D62CEBD4F322CB57EC6F</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=66EE036DF5FC1004D9ED5E9A94A1086A</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=672B13F4A0B6F27D29065123FE882DFC</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=6BBD59CEA665C4AFCC2814C1327EC91F</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=725BB81DC24214F6ECACC0CFB36AD30D</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=9528A0E91E28FBB88AD433FEABCA2456</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=9DA6D5D77BE11712527DCAB86DF449A3</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=A6E01BC1AB89F8D91D9EAB72032AAE88</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=B24C5EDDAEA4FE50C6A96A2A133521E4</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=D21BBC50DCC169D7B4D0F01962793154</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=FCC251CCEAE90D22C392215CC9A2D5D6</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Mimikatz" condition="contains">IMPHASH=55EE500BB4BDFC49F27A98AE456D8EDF</Hashes> <!-- Mimikatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=JuicyPotato" condition="contains">IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1</Hashes> <!-- JuicyPotato  -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=JuicyPotato" condition="contains">IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC</Hashes> <!-- JuicyPotato  -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=JuicyPotatoNG" condition="contains">IMPHASH=F9A28C458284584A93B14216308D31BD</Hashes> <!-- JuicyPotatoNG -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=RoguePotato" condition="contains">IMPHASH=6118619783FC175BC7EBECFF0769B46E</Hashes> <!-- RoguePotato -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=RoguePotato" condition="contains">IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA</Hashes> <!-- RoguePotato -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=RoguePotato" condition="contains">IMPHASH=563233BFA169ACC7892451F71AD5850A</Hashes> <!-- RoguePotato -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=RoguePotato" condition="contains">IMPHASH=87575CB7A0E0700EB37F2E3668671A08</Hashes> <!-- RoguePotato -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=13F08707F759AF6003837A150A371BA1</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=1781F06048A7E58B323F0B9259BE798B</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=713C29B396B907ED71A72482759ED757</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=8B114550386E31895DFAB371E741123D</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793</Hashes> <!-- PwDumpX -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=9D68781980370E00E0BD939EE5E6C141</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=B18A1401FF8F444056D29450FBC0A6CE</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Pwdump" condition="contains">IMPHASH=CB567F9498452721D77A451374955F5F</Hashes> <!-- Pwdump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Htran" condition="contains">IMPHASH=730073214094CD328547BF1F72289752</Hashes> <!-- Htran -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Cobalt Strike beacons" condition="contains">IMPHASH=17B461A082950FC6332228572138B80C</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Cobalt Strike beacons" condition="contains">IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Cobalt Strike beacons" condition="contains">IMPHASH=819B19D53CA6736448F9325A85736792</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Cobalt Strike beacons" condition="contains">IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E</Hashes> <!-- Cobalt Strike beacons -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PPLDump" condition="contains">IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74</Hashes> <!-- PPLDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PPLDump" condition="contains">IMPHASH=0588081AB0E63BA785938467E1B10CCA</Hashes> <!-- PPLDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=4DA924CF622D039D58BCE71CDF05D242</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=E7A3A5C377E2D29324093377D7DB1C66</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=E6F9D5152DA699934B30DAAB206471F6</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=3AD59991CCF1D67339B319B15A41B35D</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=FFDD59E0318B85A3E480874D9796D872</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=0CF479628D7CC1EA25EC7998A92F5051</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=NanoDump" condition="contains">IMPHASH=D6D0F80386E1380D05CB78E871BC72B1</Hashes> <!-- NanoDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=HandleKatz" condition="contains">IMPHASH=38D9E015591BBFD4929E0D0F47FA0055</Hashes> <!-- HandleKatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=HandleKatz" condition="contains">IMPHASH=0E2216679CA6E1094D63322E3412D650</Hashes> <!-- HandleKatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=DripLoader" condition="contains">IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB</Hashes> <!-- DripLoader -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=DripLoader" condition="contains">IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798</Hashes> <!-- DripLoader -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=DripLoader" condition="contains">IMPHASH=11083E75553BAAE21DC89CE8F9A195E4</Hashes> <!-- DripLoader -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=DripLoader" condition="contains">IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80</Hashes> <!-- DripLoader -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=CreateMiniDump" condition="contains">IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F</Hashes> <!-- CreateMiniDump -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=767637C23BB42CD5D7397CF58B0BE688</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=14C4E4C72BA075E9069EE67F39188AD8</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=7D010C6BB6A3726F327F7E239166D127</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=89159BA4DD04E4CE5559F132A9964EB3</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=5834ED4291BDEB928270428EBBAF7604</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=UACMe Akagi" condition="contains">IMPHASH=3DE09703C8E79ED2CA3F01074719906B</Hashes> <!-- UACMe Akagi -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=WCE" condition="contains">IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F</Hashes> <!-- WCE -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=WCE" condition="contains">IMPHASH=E96A73C7BF33A464C510EDE582318BF2</Hashes> <!-- WCE -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Sliver Stagers" condition="contains">IMPHASH=32089B8851BBF8BC2D014E9F37288C83</Hashes> <!-- Sliver Stagers -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Dumpert" condition="contains">IMPHASH=09D278F9DE118EF09163C6140255C690</Hashes> <!-- Dumpert -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Dumpert" condition="contains">IMPHASH=03866661686829d806989e2fc5a72606</Hashes> <!-- Dumpert -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Dumpert" condition="contains">IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d</Hashes> <!-- Dumpert -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=SysmonEnte" condition="contains">IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE</Hashes> <!-- SysmonEnte -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=SysmonQuiet" condition="contains">IMPHASH=19584675D94829987952432E018D5056</Hashes> <!-- SysmonQuiet -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=ShaprEvtMute Hook" condition="contains">IMPHASH=330768A4F172E10ACB6287B87289D83B</Hashes> <!-- ShaprEvtMute Hook -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Forkatz" condition="contains">IMPHASH=885C99CCFBE77D1CBFCB9C4E7C1A3313</Hashes> <!-- Forkatz -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PPLKiller" condition="contains">IMPHASH=22A22BC9E4E0D2F189F1EA01748816AC</Hashes> <!-- PPLKiller -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=PPLKiller" condition="contains">IMPHASH=7FA30E6BB7E8E8A69155636E50BF1B28</Hashes> <!-- PPLKiller -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Backstab" condition="contains">IMPHASH=96DF3A3731912449521F6F8D183279B1</Hashes> <!-- Backstab -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Backstab" condition="contains">IMPHASH=7E6CF3FF4576581271AC8A313B2AAB46</Hashes> <!-- Backstab -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=Backstab" condition="contains">IMPHASH=51791678F351C03A0EB4E2A7B05C6E17</Hashes> <!-- Backstab -->
			<Hashes name="technique_id=Known IMPHASH ,technique_name=BloodHound" condition="contains">IMPHASH=6AAA51A36C236050FBADB94E0DEF5D77</Hashes> <!-- BloodHound -->		
			<Hashes name="technique_id=Known IMPHASH ,technique_name=John" condition="contains">IMPHASH=240E335F31EF2BC57B30CAC280934F7C</Hashes> <!-- John -->			
			<Hashes name="technique_id=Known SHA1 ,technique_name=ShaprEvtMute" condition="contains">SHA1=4E18320493042BCD7D21B53E258974BC460ACC78</Hashes>	<!-- ShaprEvtMute -->
			<Hashes name="technique_id=Known SHA256 ,technique_name=ShaprEvtMute" condition="contains">SHA256=477DFE485F5BD9540CC83E88FC04AAFB6DE49CF1ADC6BD857D5D6F4C1730A6D1</Hashes>	<!-- ShaprEvtMute -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Torbrowser" condition="contains">SHA1=129b27c3926e53e5df6d44cc6adf39c3a8d9ebf7</Hashes> <!-- Torbrowser 12.1 -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Torbrowser" condition="contains">SHA1=bf5125b827a3f05103e1a480b225da8e7cea7049</Hashes> <!-- Torbrowser 12.5.1 -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Torbrowser" condition="contains">SHA1=f663b21c834b677ad5f26e321feb441c6386b1d3</Hashes> <!-- Torbrowser 13.0.1 -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Rustdesk" condition="contains">SHA1=3a9e443e8480f26ff224487c6c3b9e0b5ae7efe9</Hashes> <!-- Rustdesk 1.2 -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Rustdesk" condition="contains">SHA1=b64fa7a09eeff75084092e50de09f6aa603042a0</Hashes> <!-- Rustdesk 1.2 installed -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Mimikatz" condition="contains">SHA1=e3b6ea8c46fa831cec6f235a5cf48b38a4ae8d69</Hashes> <!-- Mimikatz 1-->
			<Hashes name="technique_id=Known SHA1 ,technique_name=Mimikatz" condition="contains">SHA1=93ed68c7e5096d936115854954135d110648e739</Hashes> <!-- Mimikatz 2 -->			
			<Hashes name="technique_id=Known SHA1 ,technique_name=LaZagne 1" condition="contains">SHA1=0E62D10FF194E84ED8C6BD71620F56EF9E557072</Hashes> <!-- LaZagne Password Dumper 1 -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=LaZagne 2" condition="contains">SHA1=a3fad01a0c10fde5b38267188860ea1da649697d</Hashes> <!-- LaZagne Password Dumper 2 -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=PCHunter64" condition="contains">SHA1=d373052c6f7492e0dd5f2c705bac6b5afe7ffc24</Hashes> <!-- Tweek Tool -->
			<Hashes name="technique_id=Known SHA1 ,technique_name=PCHunter32" condition="contains">SHA1=c4e2953509e9a47d9ee0ecfa8c886328d700ed7e</Hashes> <!-- Tweek Tool -->
		<!-- LOLBINs that can be used to download executables -->
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - certutil" condition="image">certutil.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - certoc" condition="image">certoc.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - Certreg" condition="image">CertReq.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - Desktopimgdownldr" condition="image">Desktopimgdownldr.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - esentutl.exe" condition="image">esentutl.exe</Image>
		<!-- OneNote Application Dropping Executables -->
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - onenote" condition="image">onenote.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - onenotem" condition="image">onenotem.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - onenoteim" condition="image">onenoteim.exe</Image>
		<!-- Executables that should never drop an executable to disk (but may after a previous process injection or if it's malware that uses a legitimate name)-->
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - notepad" condition="image">notepad.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - AcroRd32" condition="image">AcroRd32.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - mshta" condition="image">mshta.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Mshta/ -->
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - hh" condition="image">hh.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - calc" condition="image">calc.exe</Image>
			<Image name="technique_id=T1074.001,technique_name=Local Data Staging - mspaint" condition="image">mspaint.exe</Image>
		</FileBlockExecutable>
	 </RuleGroup>
<!-- Event ID 28 == File Block Shredding -->
	 <RuleGroup name="FileBlockShredding" groupRelation="or">
       <FileBlockShredding onmatch="include">
	    <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.sys</TargetFilename> <!--Driver file.-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.rft</TargetFilename> <!--Microsoft:Windows:Revisable Form Text Document: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.jsp</TargetFilename> <!--Microsoft:Windows:Jakarta Server Page: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.jspx</TargetFilename> <!--Microsoft:Windows:XML Jakarta Server Page: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.asp</TargetFilename> <!--Microsoft:Windows:Active Server Page: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.aspx</TargetFilename> <!--Microsoft:Windows:Active Server Page Extended File: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.php</TargetFilename> <!--Microsoft:Windows:PHP Source Code File: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.war</TargetFilename> <!--Microsoft:Windows:Java Web Archive: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.ace</TargetFilename> <!--Microsoft:Windows:WinAce Compressed File: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.iqy</TargetFilename> <!--Microsoft:Windows:Internet Query: -->
		<TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.slk</TargetFilename> <!--Microsoft:Windows:Symbolic Link File: -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.docm</TargetFilename> <!--Microsoft:Office:Word: With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.pptm</TargetFilename> <!--Microsoft:Office:PowerPoint: With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.xlsm</TargetFilename> <!--Microsoft:Office:Excel: With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.xlm</TargetFilename> <!--Microsoft:Office:Excel: Legacy Excel With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.dotm</TargetFilename> <!--Microsoft:Office:Word: Template With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.xltm</TargetFilename> <!--Microsoft:Office:Excel: Template With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.potm</TargetFilename> <!--Microsoft:Office:PowerPoint: Template With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.ppsm</TargetFilename> <!--Microsoft:Office:PowerPoint: Slideshow With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.sldm</TargetFilename> <!--Microsoft:Office:PowerPoint: Slide With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.xlam</TargetFilename> <!--Microsoft:Office:Excel: Add-in Possibly With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.xla</TargetFilename> <!--Microsoft:Office:Excel: Add-in Possibly With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.xll</TargetFilename> <!--Microsoft:Office:Excel: Add-in Possibly With Macro-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.settingcontent-ms</TargetFilename> <!--Microsoft:Windows:SettingContent-MS (https://posts.specterops.io/the-tale-of-settingcontent-ms-files-f1ea253e4d39)-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.application</TargetFilename> <!--Microsoft:ClickOnce: [ https://blog.netspi.com/all-you-need-is-one-a-clickonce-love-story/ ] -->
	    <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.appref-ms</TargetFilename> <!--Microsoft:ClickOnce application | Credit @ion-storm -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.kirbi</TargetFilename> <!--Mimikatz or kekeo default kerberos ticket file extention-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.iso</TargetFilename> <!--often ignored by AV/EDR but opens like a zip file in windows-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.img</TargetFilename> <!--often ignored by AV/EDR but opens like a zip file in windows-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.hta</TargetFilename> <!--HTA Scripting-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.exe</TargetFilename> <!--Executable-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.dll</TargetFilename> <!--Executable-->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.ps1</TargetFilename> <!--PowerShell [ More information: http://www.hexacorn.com/blog/2014/08/27/beyond-good-ol-run-key-part-16/ ] -->
	    <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.ps2</TargetFilename> <!--PowerShell [ More information: http://www.hexacorn.com/blog/2014/08/27/beyond-good-ol-run-key-part-16/ ] -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.psm1</TargetFilename> <!--PowerShell [ More information: http://www.hexacorn.com/blog/2014/08/27/beyond-good-ol-run-key-part-16/ ] -->
        <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.bat</TargetFilename> <!--Batch scripting-->
	    <TargetFilename name="technique_id=T1485,technique_name=Data Destruction" condition="end with">.cmd</TargetFilename> <!--Batch scripting: Batch scripts can also use the .cmd extension | Credit: @mmazanec -->
	   </FileBlockShredding>
	   </RuleGroup>	
<!-- Event ID 29 == File Executable Detected - Exclude -->
	<RuleGroup name="" groupRelation="or">
	 <FileExecutableDetected onmatch="exclude">
		<Image condition="end with">MsMpEng.exe</Image>
		<Image condition="is">C:\Program Files\AccessData\FTK Imager\FTK Imager.exe</Image>
		<Rule groupRelation="and">
			<Image condition="end with">\AppData\Local\Microsoft\OneDrive\StandaloneUpdater\OneDriveSetup.exe</Image>
			<TargetFilename condition="contains">\AppData\Local\Microsoft\OneDrive\</TargetFilename>
		</Rule>
		<Rule groupRelation="and">
			<Image condition="end with">\AppData\Local\Microsoft\OneDrive\Update\OneDriveSetup.exe</Image>
			<TargetFilename condition="contains">\AppData\Local\Microsoft\OneDrive\</TargetFilename>
		</Rule>	
		<Rule groupRelation="and">
			<Image condition="is">atieclxx.exe</Image>
			<TargetFilename condition="is">C:\Windows\System32\config\systemprofile\AppData\Local\AMD\atieclxx.exe</TargetFilename>
		</Rule>
		<Rule groupRelation="and">
			<Image condition="end with">\MailServer\plugins\avserver\avserver.exe</Image>
			<TargetFilename condition="contains">\MailServer\MailServer\bitdefender\</TargetFilename>
		</Rule>
			<Rule groupRelation="and">
			<Image condition="end with">\TiWorker.exe</Image>
			<TargetFilename condition="begin with">C:\Windows\CbsTemp</TargetFilename>
		</Rule>
		<Rule groupRelation="and">
			<Image condition="is">C:\WINDOWS\system32\cleanmgr.exe</Image>
			<TargetFilename condition="contains">\AppData\Local\</TargetFilename>
		</Rule>		
		<Rule groupRelation="and">
			<Image condition="end with">\mscorsvw.exe</Image>
			<TargetFilename condition="contains">C:\Windows\assembly\</TargetFilename>
		</Rule>		
	 </FileExecutableDetected>
	</RuleGroup>
<!-- Event ID 29 == File Executable Detected -->	 
		<RuleGroup name="" groupRelation="or">
        <FileExecutableDetected onmatch="include">
	<!-- LOLBAS Living of the LAN -->
		<Image name="technique_id=T1218.005,technique_name=LOLBAS Mshta" condition="image">mshta.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Mshta/ -->
		<Image name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - msiexec" condition="is">msiexec.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Msiexec/ -->
		<Image name="technique_id=T1218,technique_name=LOLBAS System Binary Proxy Execution - PresentationHost" condition="is">PresentationHost.exe</Image> <!--REF: https://lolbas-project.github.io/lolbas/Binaries/Presentationhost/ -->
		<Image name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - Microsoft.Workflow.Compiler" condition="is">Microsoft.Workflow.Compiler.exe</Image> <!--https://lolbas-project.github.io/lolbas/Binaries/Microsoft.Workflow.Compiler/-->
		<Image name="technique_id=T1127,technique_name=LOLBAS Trusted Developer Utilities Proxy Execution - jsc" condition="is">jsc.exe</Image> <!-- https://lolbas-project.github.io/lolbas/Binaries/Jsc/ -->
	<!-- Living of the LAN -->
		<Image name="technique_id=T1546.008,technique_name=Windows Error Reporting" condition="contains">werfault.exe</Image>
		<Image name="technique_id=T1574.002,technique_name=DLL Side-Loading" condition="is">odbcconf.exe</Image> <!--Microsoft:Windows: allows for driver loads -->
		<Image name="technique_id=T1027.004,technique_name=Compile After Delivery" condition="is">csc.exe</Image>
		<Image name="technique_id=T1543.003,technique_name=Windows Service" condition="is">sc.exe</Image>
		<Image name="technique_id=T1489,technique_name=Service Stop" condition="is">taskkill.exe</Image>
		<Image name="technique_id=T1074,technique_name=Data Staged" condition="is">xcopy.exe</Image>
		<Image name="technique_id=T1074,technique_name=Data Staged" condition="is">robocopy.exe</Image>
		<Image name="technique_id=T,technique_name=" condition="is">makecab.exe</Image>
		<Image name="technique_id=T1105,technique_name=Remote File Copy" condition="is">GfxDownloadWrapper.exe</Image>
		<Image name="technique_id=T1105,technique_name=Remote File Copy" condition="is">expand.exe</Image>
		<Image name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">curl.exe</Image>
		<Image name="technique=T1105,technique_name=Ingress Tool Transfer" condition="is">ftp.exe</Image>
		<Image name="technique_id=T1564.004,technique_name=NTFS File Attributes" condition="is">extrac32.exe</Image>
		<Image name="technique_id=T1053.005,technique_name=Scheduled Task/Job" condition="contains any">schtasks.exe;sctasks.exe</Image>
		<Image name="technique=T1053.002,technique_name=At" condition="contains any">at.exe;At.exe</Image>
		<Image name="technique_id=T1053,technique_name=Scheduled Task/Job" condition="is">taskeng.exe</Image>
		<Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
		<Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">wmiprvse.exe</Image>
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="image">pcalua.exe</Image> <!--Microsoft:Windows: Program Compatibility Assistant)-->
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">cscript.exe</Image>
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wscript.exe</Image>
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">bash.exe</Image> <!--Microsoft:Windows: bash on Windows, Linux subsystem-->
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">certutil.exe</Image>
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">winrs.exe</Image>
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="image">control.exe</Image> <!-- https://twitter.com/rikvduijn/status/853251879320662017 -->
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">desktopimgdownldr.exe</Image>
		<Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wsl.exe</Image>
		<Image name="technique_id=T1218.001,technique_name=Compiled HTML File" condition="is">hh.exe</Image> <!--Microsoft:Windows: HTML Helper-->
		<Image name="technique_id=T1218.004,technique_name=InstallUtil" condition="is">installutil.exe</Image>
		<Image name="technique_id=T1218.005,technique_name=Mshta" condition="image">mshta.exe</Image>
		<Image name="technique_id=T1218.005,technique_name=Mshta" condition="is">mshta.exe</Image>
		<Image name="technique_id=T1218.010,technique_name=Regsvr32" condition="is">regsvr32.exe</Image> <!--Mitre T1218.010--> <!--Mitre T1085--> <!--Microsoft:Windows: [ https://subt0x10.blogspot.com/2016/04/bypass-application-whitelisting-script.html ] -->
		<Image name="technique_id=T1218.011,technique_name=rundll32.exe" condition="contains">rundll32.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">InfDefaultInstall.EXE</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">extexport.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msconfig.EXE</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msiexec.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">odbcconf.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">PresentationHost.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">rasdlui.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">RegisterCimProvider2.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">RegisterCimProvider.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">ScriptRunner.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">verclsid.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wab.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wab.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wsreset.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">Appvlp.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">csi.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">devtoolslauncher.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">Scriptrunner.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">tttracer.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msdt.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">rasautou.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">Register-cimprovider.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">diskshadow.exe</Image> <!--This only applies to versions of Windows Server-->
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">replace.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="image">jjs.exe</Image>
		<Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="image">appcmd.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">vbc.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">csc.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dfsvc.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">mftrace.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dxcap.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">ilasm.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">jsc.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vbc.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">Microsoft.Workflow.Compiler.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vsjitdebugger.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">tracker.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">te.exe</Image>
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">rcsi.exe</Image>	
	<!-- Microsoft MSbuild -->
		<Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">MSBuild.exe</Image>	
	<!-- Windows Office -->
		<Image name="technique_id=T1137,technique_name=Office Application Startup" condition="image">excel.exe</Image>
		<Image name="technique_id=T1137,technique_name=Office Application Startup" condition="image">winword.exe</Image>
		<Image name="technique_id=T1137,technique_name=Office Application Startup" condition="image">powerpnt.exe</Image>
		<Image name="technique_id=T1137,technique_name=Office Application Startup" condition="image">outlook.exe</Image>
		<Image name="technique_id=T1137,technique_name=Office Application Startup" condition="image">msaccess.exe</Image>
		<Image name="technique_id=T1137,technique_name=Office Application Startup" condition="image">mspub.exe</Image>
	<!-- Shells -->
		<Image name="technique_id=T1059.003,technique_name=LOLBAS Windows Command Shell" condition="is">cmd.exe</Image> <!--https://lolbas-project.github.io/lolbas/Binaries/Cmd/ Multiple options-->
		<Image name="technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell.exe</Image>
		<Image name="technique_id=T1059.001,technique_name=PowerShell" condition="image">pwsh.exe</Image>
		<Image name="technique_id=T1059.001,technique_name=PowerShell" condition="image">powershell_ise.exe</Image>
		<Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">Sqlps.exe</Image>
	<!-- Windows remote management -->
		<Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">wsmprovhost.exe</Image>
        <Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">winrshost.exe</Image>
        <Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="image">winrm.cmd</Image>
	<!-- Mailserver System -->
		<TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - KerioMailserver" condition="contains">\MailServer\MailServer</TargetFilename> <!-- KerioMailserver installation -->
	<!-- Sysmon folders -->	
		<TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Sysmon Folder" condition="begin with">C:\Sysmon</TargetFilename>	<!-- Sysmon folder -->
		<TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Sysmon Folder - Windows" condition="begin with">C:\Windows\Sysmon</TargetFilename>	<!-- Sysmon folder -->
	<!-- User writable_folders -->
	     <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Intel" condition="begin with">C:\ProgramData\Intel</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Mozilla" condition="begin with">C:\ProgramData\Mozilla</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - chocolatey" condition="begin with">C:\ProgramData\chocolatey\</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - DeviceSync" condition="begin with">C:\ProgramData\Microsoft\DeviceSync</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - PlayReady" condition="begin with">C:\ProgramData\Microsoft\PlayReady</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - User Account Pictures" condition="begin with">C:\ProgramData\Microsoft\User Account Pictures</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Heartbeat" condition="begin with">C:\ProgramData\Microsoft\Office\Heartbeat</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - WER" condition="begin with">C:\ProgramData\Microsoft\Windows\WER</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - All Users" condition="begin with">C:\Users\All Users\</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Tasks" condition="begin with">C:\Windows\Tasks</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - tracing" condition="begin with">C:\Windows\tracing</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Tasks 32" condition="begin with">C:\Windows\System32\Tasks</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - color" condition="begin with">C:\Windows\System32\spool\drivers\color</TargetFilename>
         <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Tasks 64" condition="begin with">C:\Windows\SysWOW64\Tasks</TargetFilename>
		 <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Desktop" condition="contains all">\Users;\Desktop;</TargetFilename> <!-- File Executable creation detected in user Desktop Folder -->
		 <TargetFilename name="technique_id=T1105,technique_name=Ingress Tool Transfer - Watched Folders - Startup" condition="contains">\Microsoft\Windows\Start Menu\Programs\Startup\</TargetFilename> <!-- File Executable creation detected in Startup folder Folder -->
	 </FileExecutableDetected>
    </RuleGroup>	   
   </EventFiltering>
</Sysmon>